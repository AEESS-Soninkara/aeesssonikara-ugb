<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AEESS - Réseau Étudiant</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <!-- Ajout de DOMPurify pour la sécurité -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.0.5/purify.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-green: #2d7a3e;
            --light-green: #4a9d5f;
            --dark-green: #1a5229;
            --accent: #3a8c4f;
            --bg-light: #f0f2f5;
            --white: #ffffff;
            --text-dark: #1c1e21;
            --text-light: #65676b;
            --border: #e4e6eb;
            --hover-bg: #f2f3f5;
            --shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.12);
            --radius: 12px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --error: #e74c3c;
            --warning: #f39c12;
            --success: #27ae60;
            --info: #3498db;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            line-height: 1.6;
            color: var(--text-dark);
            background: var(--bg-light);
            overflow-x: hidden;
        }

        /* Navigation améliorée */
        nav {
            background: var(--white);
            padding: 0.75rem 1.5rem;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: var(--shadow);
            backdrop-filter: blur(10px);
            transition: var(--transition);
        }

        .nav-container {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-green);
            text-decoration: none;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary-green), var(--light-green));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
        }

        .nav-links {
            display: flex;
            gap: 1.5rem;
            list-style: none;
        }

        .nav-links a {
            color: var(--text-dark);
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            transition: var(--transition);
            font-weight: 500;
            position: relative;
        }

        .nav-links a:hover {
            background: var(--hover-bg);
            color: var(--primary-green);
        }

        .nav-links a::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 0;
            height: 2px;
            background: var(--primary-green);
            transition: var(--transition);
            transform: translateX(-50%);
        }

        .nav-links a:hover::after {
            width: 80%;
        }

        .btn {
            padding: 0.7rem 1.5rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 600;
            transition: var(--transition);
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: var(--primary-green);
            color: var(--white);
            box-shadow: 0 4px 12px rgba(45, 122, 62, 0.3);
        }

        .btn-primary:hover {
            background: var(--dark-green);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(45, 122, 62, 0.4);
        }

        .btn-secondary {
            background: var(--white);
            color: var(--primary-green);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            background: var(--hover-bg);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        /* Hero Section améliorée */
        .hero {
            background: linear-gradient(135deg, var(--primary-green) 0%, var(--dark-green) 100%);
            color: var(--white);
            padding: 6rem 2rem;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 100" fill="%23ffffff" opacity="0.05"><polygon points="1000,100 1000,0 0,100"></polygon></svg>');
            background-size: cover;
        }

        .hero-content {
            max-width: 800px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        .hero h1 {
            font-size: 3rem;
            margin-bottom: 1.5rem;
            font-weight: 700;
            line-height: 1.2;
            animation: fadeInUp 1s ease-out;
        }

        .hero p {
            font-size: 1.25rem;
            margin-bottom: 2.5rem;
            opacity: 0.9;
            animation: fadeInUp 1s ease-out 0.2s both;
        }

        .hero-stats {
            display: flex;
            justify-content: center;
            gap: 3rem;
            margin-top: 3rem;
            flex-wrap: wrap;
            animation: fadeInUp 1s ease-out 0.4s both;
        }

        .stat {
            text-align: center;
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            background: linear-gradient(to right, #fff, #e8f5e9);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .hero-actions {
            margin-top: 2.5rem;
            animation: fadeInUp 1s ease-out 0.6s both;
        }

        /* Sections publiques améliorées */
        section {
            padding: 5rem 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        .section-header {
            text-align: center;
            margin-bottom: 3rem;
        }

        h2 {
            color: var(--primary-green);
            font-size: 2.5rem;
            margin-bottom: 1rem;
            font-weight: 700;
        }

        .section-subtitle {
            font-size: 1.2rem;
            color: var(--text-light);
            max-width: 700px;
            margin: 0 auto;
        }

        .actions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }

        .action-card {
            background: var(--white);
            padding: 2.5rem 2rem;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            transition: var(--transition);
            border: 1px solid var(--border);
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .action-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(to right, var(--primary-green), var(--light-green));
        }

        .action-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-lg);
        }

        .action-icon {
            font-size: 3rem;
            margin-bottom: 1.5rem;
            color: var(--primary-green);
        }

        .action-card h3 {
            color: var(--text-dark);
            margin-bottom: 1rem;
            font-size: 1.4rem;
        }

        .crisis-alert {
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
            border-left: 5px solid #fdcb6e;
            padding: 2.5rem;
            margin: 2rem 0;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(253, 203, 110, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(253, 203, 110, 0); }
            100% { box-shadow: 0 0 0 0 rgba(253, 203, 110, 0); }
        }

        .payment-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }

        .payment-card {
            background: var(--white);
            padding: 2.5rem 2rem;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            text-align: center;
            border: 1px solid var(--border);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .payment-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(to right, var(--primary-green), var(--light-green));
        }

        .payment-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .payment-icon {
            font-size: 3rem;
            margin-bottom: 1.5rem;
            color: var(--primary-green);
        }

        .payment-number {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-green);
            margin: 1rem 0;
            background: var(--bg-light);
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            display: inline-block;
        }

        /* Animations */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .fade-in {
            animation: fadeIn 1s ease-out;
        }

        /* Social Dashboard amélioré */
        .social-dashboard {
            display: none;
            background: var(--bg-light);
            min-height: 100vh;
        }

        .social-dashboard.active {
            display: block;
            animation: fadeIn 0.5s ease-out;
        }

        .social-header {
            background: var(--white);
            padding: 1rem 2rem;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }

        .social-nav {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 1.5rem;
        }

        .social-logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-green);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .social-search {
            flex: 1;
            max-width: 500px;
            position: relative;
        }

        .social-search input {
            width: 100%;
            padding: 0.75rem 1rem 0.75rem 2.5rem;
            border: 1px solid var(--border);
            border-radius: 24px;
            font-size: 0.95rem;
            background: var(--bg-light);
            transition: var(--transition);
        }

        .social-search input:focus {
            outline: none;
            background: var(--white);
            box-shadow: 0 0 0 2px rgba(45, 122, 62, 0.2);
        }

        .search-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-light);
        }

        .social-actions {
            display: flex;
            gap: 0.75rem;
        }

        .social-main {
            max-width: 1400px;
            margin: 2rem auto;
            padding: 0 1.5rem;
            display: grid;
            grid-template-columns: 280px 1fr 320px;
            gap: 2rem;
        }

        /* Sidebar gauche amélioré */
        .sidebar-left {
            background: var(--white);
            border-radius: var(--radius);
            padding: 1.5rem;
            box-shadow: var(--shadow);
            height: fit-content;
            position: sticky;
            top: 90px;
            transition: var(--transition);
        }

        .sidebar-left:hover {
            box-shadow: var(--shadow-lg);
        }

        .user-profile-card {
            text-align: center;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--border);
            margin-bottom: 1rem;
        }

        .user-avatar-big {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-green), var(--light-green));
            color: var(--white);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: bold;
            margin: 0 auto 1rem;
            box-shadow: 0 4px 12px rgba(45, 122, 62, 0.3);
        }

        .sidebar-menu {
            list-style: none;
        }

        .sidebar-menu li {
            margin-bottom: 0.5rem;
        }

        .sidebar-menu a {
            display: flex;
            align-items: center;
            gap: 0.8rem;
            padding: 0.8rem 1rem;
            color: var(--text-dark);
            text-decoration: none;
            border-radius: 8px;
            transition: var(--transition);
            font-weight: 500;
        }

        .sidebar-menu a:hover, .sidebar-menu a.active {
            background: var(--primary-green);
            color: var(--white);
            transform: translateX(5px);
        }

        /* Feed central amélioré */
        .news-feed {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .create-post-card {
            background: var(--white);
            padding: 1.5rem;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .create-post-card:hover {
            box-shadow: var(--shadow-lg);
        }

        .post-input-container {
            display: flex;
            gap: 1rem;
            align-items: center;
            margin-bottom: 1rem;
        }

        .post-avatar-small {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-green), var(--light-green));
            color: var(--white);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
            box-shadow: 0 2px 8px rgba(45, 122, 62, 0.3);
        }

        .post-input {
            flex: 1;
            padding: 1rem 1.5rem;
            border: 1px solid var(--border);
            border-radius: 24px;
            cursor: pointer;
            background: var(--bg-light);
            color: var(--text-light);
            transition: var(--transition);
            font-size: 1rem;
        }

        .post-input:hover {
            background: var(--hover-bg);
        }

        .post-actions-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.5rem;
            border-top: 1px solid var(--border);
            padding-top: 1rem;
        }

        .post-action-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.7rem;
            border: none;
            background: none;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
            color: var(--text-dark);
            font-size: 0.95rem;
            font-weight: 500;
        }

        .post-action-btn:hover {
            background: var(--hover-bg);
            transform: translateY(-2px);
        }

        /* Post Card amélioré */
        .post-card {
            background: var(--white);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            overflow: hidden;
            transition: var(--transition);
            animation: fadeInUp 0.5s ease-out;
        }

        .post-card:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-5px);
        }

        .post-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1.5rem 1.5rem 1rem;
        }

        .post-user-info {
            flex: 1;
        }

        .post-user-info h4 {
            margin-bottom: 0.2rem;
            font-weight: 600;
        }

        .post-meta {
            font-size: 0.85rem;
            color: var(--text-light);
        }

        .post-content {
            padding: 0 1.5rem 1rem;
            font-size: 1rem;
            line-height: 1.6;
        }

        .post-image {
            width: 100%;
            max-height: 500px;
            object-fit: cover;
            border-radius: 8px;
        }

        .post-stats {
            display: flex;
            justify-content: space-between;
            padding: 0.8rem 1.5rem;
            border-top: 1px solid var(--border);
            font-size: 0.9rem;
            color: var(--text-light);
        }

        .post-actions-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            border-top: 1px solid var(--border);
        }

        .post-action-button {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.8rem;
            border: none;
            background: none;
            cursor: pointer;
            transition: var(--transition);
            color: var(--text-dark);
            font-weight: 600;
        }

        .post-action-button:hover {
            background: var(--hover-bg);
        }

        .post-action-button.liked {
            color: var(--primary-green);
        }

        /* Comments améliorés */
        .comments-section {
            padding: 1rem 1.5rem;
            border-top: 1px solid var(--border);
            background: var(--bg-light);
        }

        .comment-input-container {
            display: flex;
            gap: 0.75rem;
            margin-bottom: 1rem;
            align-items: center;
        }

        .comment-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--light-green);
            color: var(--white);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.85rem;
            font-weight: bold;
            flex-shrink: 0;
        }

        .comment-input {
            flex: 1;
            padding: 0.65rem 1rem;
            border: 1px solid var(--border);
            border-radius: 24px;
            background: var(--white);
            font-size: 0.9rem;
            font-family: inherit;
            transition: var(--transition);
        }

        .comment-input:focus {
            outline: none;
            box-shadow: 0 0 0 2px rgba(45, 122, 62, 0.2);
        }

        .comment-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .comment-item {
            display: flex;
            gap: 0.75rem;
            margin-top: 0.75rem;
            animation: fadeIn 0.3s ease-out;
        }

        .comment-bubble {
            background: var(--white);
            padding: 0.75rem 1rem;
            border-radius: 18px;
            display: inline-block;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .comment-author {
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: 0.25rem;
        }

        .comment-text {
            font-size: 0.9rem;
        }

        .comment-time {
            font-size: 0.8rem;
            color: var(--text-light);
            margin-top: 0.25rem;
            padding-left: 1rem;
        }

        /* Sidebar droite améliorée */
        .sidebar-right {
            height: fit-content;
            position: sticky;
            top: 90px;
        }

        .sidebar-section {
            background: var(--white);
            border-radius: var(--radius);
            padding: 1.5rem;
            box-shadow: var(--shadow);
            margin-bottom: 1.5rem;
            transition: var(--transition);
        }

        .sidebar-section:hover {
            box-shadow: var(--shadow-lg);
        }

        .sidebar-title {
            font-weight: 600;
            font-size: 1.1rem;
            margin-bottom: 1rem;
            color: var(--text-dark);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .event-item {
            display: flex;
            gap: 1rem;
            padding: 1rem 0;
            border-bottom: 1px solid var(--border);
            transition: var(--transition);
        }

        .event-item:hover {
            background: var(--hover-bg);
            border-radius: 8px;
            padding: 1rem;
            margin: 0 -0.5rem;
        }

        .event-item:last-child {
            border-bottom: none;
        }

        .event-date {
            background: linear-gradient(135deg, var(--primary-green), var(--light-green));
            color: var(--white);
            padding: 0.5rem;
            border-radius: 8px;
            text-align: center;
            min-width: 50px;
            box-shadow: 0 2px 8px rgba(45, 122, 62, 0.3);
        }

        .event-day {
            font-size: 1.2rem;
            font-weight: bold;
        }

        .event-month {
            font-size: 0.8rem;
        }

        .event-details h4 {
            margin-bottom: 0.3rem;
            font-size: 0.95rem;
            font-weight: 600;
        }

        .event-details p {
            font-size: 0.85rem;
            color: var(--text-light);
        }

        .user-suggestion {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--border);
            transition: var(--transition);
        }

        .user-suggestion:hover {
            background: var(--hover-bg);
            border-radius: 8px;
            padding: 0.75rem;
            margin: 0 -0.5rem;
        }

        .user-suggestion:last-child {
            border-bottom: none;
        }

        .suggestion-info {
            flex: 1;
        }

        .suggestion-name {
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: 0.2rem;
        }

        .suggestion-meta {
            font-size: 0.8rem;
            color: var(--text-light);
        }

        .add-friend-btn {
            padding: 0.3rem 0.8rem;
            border: 1px solid var(--primary-green);
            background: none;
            color: var(--primary-green);
            border-radius: 15px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
        }

        .add-friend-btn:hover {
            background: var(--primary-green);
            color: var(--white);
            transform: scale(1.05);
        }

        /* Modal amélioré */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
            animation: fadeIn 0.3s ease-out;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--white);
            padding: 2rem;
            border-radius: var(--radius);
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
            animation: fadeInUp 0.4s ease-out;
            position: relative;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border);
        }

        .modal-header h3 {
            font-size: 1.3rem;
            font-weight: 600;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-light);
            padding: 0.25rem;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: var(--transition);
        }

        .close-btn:hover {
            background: var(--hover-bg);
            color: var(--text-dark);
        }

        .form-group {
            margin-bottom: 1.2rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            font-size: 0.95rem;
            color: var(--text-dark);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 1rem;
            font-family: inherit;
            transition: var(--transition);
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary-green);
            box-shadow: 0 0 0 2px rgba(45, 122, 62, 0.2);
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        .modal-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 1.5rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border);
        }

        .post-options {
            display: flex;
            gap: 0.5rem;
        }

        .post-option-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 8px;
            transition: var(--transition);
            color: var(--text-light);
        }

        .post-option-btn:hover {
            background: var(--hover-bg);
            color: var(--primary-green);
            transform: scale(1.1);
        }

        #postPreview {
            margin-top: 1rem;
            border-radius: 8px;
            overflow: hidden;
        }

        #postPreview img {
            max-width: 100%;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .hidden {
            display: none !important;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--primary-green);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 2rem auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .online-indicator {
            width: 10px;
            height: 10px;
            background: #4CAF50;
            border-radius: 50%;
            border: 2px solid var(--white);
            position: absolute;
            bottom: 0;
            right: 0;
            box-shadow: 0 0 0 2px var(--primary-green);
        }

        /* Footer amélioré */
        footer {
            background: linear-gradient(135deg, var(--dark-green), var(--primary-green));
            color: var(--white);
            padding: 3rem 2rem;
            text-align: center;
            margin-top: 4rem;
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
        }

        .footer-links {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .footer-links a {
            color: var(--white);
            text-decoration: none;
            transition: var(--transition);
            opacity: 0.9;
        }

        .footer-links a:hover {
            opacity: 1;
            text-decoration: underline;
        }

        /* NOUVEAUX STYLES POUR LES AMÉLIORATIONS */

        /* Système de notifications */
        .notification-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 3000;
            max-width: 400px;
        }

        .notification {
            background: var(--white);
            padding: 1rem 1.5rem;
            margin-bottom: 0.5rem;
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
            border-left: 4px solid var(--primary-green);
            animation: slideInRight 0.3s ease-out;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .notification.error {
            border-left-color: var(--error);
        }

        .notification.warning {
            border-left-color: var(--warning);
        }

        .notification.success {
            border-left-color: var(--success);
        }

        .notification.info {
            border-left-color: var(--info);
        }

        .notification-icon {
            font-size: 1.2rem;
        }

        .notification-content {
            flex: 1;
        }

        .notification-close {
            background: none;
            border: none;
            cursor: pointer;
            color: var(--text-light);
            padding: 0.25rem;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 0.5rem;
            margin-top: 2rem;
            padding: 1rem;
        }

        .pagination-btn {
            padding: 0.5rem 1rem;
            border: 1px solid var(--border);
            background: var(--white);
            border-radius: 6px;
            cursor: pointer;
            transition: var(--transition);
        }

        .pagination-btn:hover:not(:disabled) {
            background: var(--primary-green);
            color: var(--white);
        }

        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .pagination-info {
            font-size: 0.9rem;
            color: var(--text-light);
        }

        /* Messagerie */
        .messaging-container {
            background: var(--white);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            overflow: hidden;
        }

        .conversation-list {
            border-right: 1px solid var(--border);
            max-height: 600px;
            overflow-y: auto;
        }

        .conversation-item {
            padding: 1rem;
            border-bottom: 1px solid var(--border);
            cursor: pointer;
            transition: var(--transition);
        }

        .conversation-item:hover, .conversation-item.active {
            background: var(--hover-bg);
        }

        .message-container {
            max-height: 500px;
            overflow-y: auto;
            padding: 1rem;
        }

        .message {
            margin-bottom: 1rem;
            display: flex;
            gap: 0.5rem;
        }

        .message.own {
            flex-direction: row-reverse;
        }

        .message-bubble {
            max-width: 70%;
            padding: 0.75rem 1rem;
            border-radius: 18px;
            background: var(--bg-light);
        }

        .message.own .message-bubble {
            background: var(--primary-green);
            color: var(--white);
        }

        /* Statistiques */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .stat-card {
            background: var(--white);
            padding: 1.5rem;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            text-align: center;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary-green);
            margin-bottom: 0.5rem;
        }

        /* Modération */
        .moderation-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .mod-btn {
            padding: 0.25rem 0.75rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
        }

        .mod-btn.delete {
            background: var(--error);
            color: white;
        }

        .mod-btn.warn {
            background: var(--warning);
            color: white;
        }

        /* Accessibilité */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        /* Focus styles améliorés */
        button:focus-visible, 
        input:focus-visible, 
        textarea:focus-visible {
            outline: 2px solid var(--primary-green);
            outline-offset: 2px;
        }

        /* Loading states améliorés */
        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }

        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        /* Responsive amélioré */
        @media (max-width: 1200px) {
            .social-main {
                grid-template-columns: 1fr;
            }
            
            .sidebar-left, .sidebar-right {
                display: none;
            }

            .social-actions {
                flex-wrap: wrap;
            }

            .social-actions .btn {
                padding: 0.5rem;
                font-size: 0.85rem;
            }
        }

        @media (max-width: 768px) {
            .nav-links {
                display: none;
            }

            .hero h1 {
                font-size: 2.2rem;
            }

            .hero p {
                font-size: 1.1rem;
            }

            .social-search {
                max-width: 200px;
            }

            .social-actions {
                gap: 0.25rem;
            }

            h2 {
                font-size: 2rem;
            }

            section {
                padding: 3rem 1.5rem;
            }

            .notification-container {
                left: 20px;
                right: 20px;
                max-width: none;
            }
        }

        /* Scrollbar personnalisée */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-light);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary-green);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--dark-green);
        }

        /* Loading states */
        .loading {
            opacity: 0.7;
            pointer-events: none;
        }

        /* Notification badge */
        .notification-badge {
            background: #ff4757;
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
            position: absolute;
            top: -5px;
            right: -5px;
        }

        /* Dashboard sections améliorées */
        .dashboard-section {
            background: var(--white);
            border-radius: var(--radius);
            padding: 2rem;
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
        }

        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .quick-action-card {
            background: var(--bg-light);
            padding: 1.5rem;
            border-radius: var(--radius);
            text-align: center;
            transition: var(--transition);
            cursor: pointer;
            border: 2px solid transparent;
        }

        .quick-action-card:hover {
            border-color: var(--primary-green);
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .quick-action-icon {
            font-size: 2rem;
            color: var(--primary-green);
            margin-bottom: 0.5rem;
        }
    </style>
</head>
<body>
    <!-- Container pour les notifications -->
    <div class="notification-container" id="notificationContainer"></div>

    <!-- Navigation -->
    <nav>
        <div class="nav-container">
            <a href="#" class="logo">
                <div class="logo-icon">
                    <i class="fas fa-graduation-cap"></i>
                </div>
                <span>AEESS</span>
            </a>
            <ul class="nav-links" id="publicNav">
                <li><a href="#accueil">Accueil</a></li>
                <li><a href="#apropos">À propos</a></li>
                <li><a href="#dons">Soutenez-nous</a></li>
                <li><a href="#contact">Contact</a></li>
            </ul>
            <div>
                <button class="btn btn-primary" id="loginBtn" onclick="showLogin()">
                    <i class="fas fa-sign-in-alt"></i> Connexion
                </button>
            </div>
        </div>
    </nav>

    <!-- Public Content -->
    <div id="publicContent">
        <section class="hero" id="accueil">
            <div class="hero-content">
                <h1>ENSEMBLE, SOUTENONS NOS ÉTUDIANTS</h1>
                <p>L'Association des Élèves et Étudiants Soninké à Saint-Louis accueille et accompagne les nouveaux bacheliers orientés à l'Université Gaston Berger</p>
                <div class="hero-stats">
                    <div class="stat">
                        <div class="stat-number">30+</div>
                        <div>Nouveaux étudiants 2025</div>
                    </div>
                    <div class="stat">
                        <div class="stat-number">280K</div>
                        <div>FCFA de caution payée</div>
                    </div>
                    <div class="stat">
                        <div class="stat-number">10+</div>
                        <div>Années d'existence</div>
                    </div>
                </div>
                <div class="hero-actions">
                    <a href="#dons" class="btn btn-secondary" style="margin-right: 1rem;">
                        <i class="fas fa-hand-holding-heart"></i> Faire un don
                    </a>
                    <button class="btn btn-primary" onclick="showRegister()">
                        <i class="fas fa-user-plus"></i> Devenir membre
                    </button>
                </div>
            </div>
        </section>

        <section id="apropos">
            <div class="section-header">
                <h2>À Propos de l'AEESS</h2>
                <p class="section-subtitle">Notre mission est d'accompagner les étudiants soninkés dans leur parcours universitaire à Saint-Louis</p>
            </div>
            <div class="crisis-alert">
                <h3><i class="fas fa-home"></i> Notre Mission : Résoudre la Crise du Logement</h3>
                <p>L'UGB manque d'infrastructures. En 2025, nous avons accueilli 30 nouveaux bacheliers. La caution d'un appartement coûte 280 000 FCFA, les loyers varient de 30 000 à 50 000 FCFA/mois. Nous avons prélevé 150 000 FCFA de notre caisse. Sans votre aide, notre mission est compromise.</p>
            </div>
        </section>

        <section id="dons">
            <div class="section-header">
                <h2><i class="fas fa-heart"></i> Soutenez-nous</h2>
                <p class="section-subtitle">Votre contribution permet d'offrir un toit et un accompagnement à nos étudiants</p>
            </div>
            <div class="payment-cards">
                <div class="payment-card">
                    <div class="payment-icon">
                        <i class="fas fa-mobile-alt"></i>
                    </div>
                    <h3>Wave</h3>
                    <div class="payment-number">78 247 74 12</div>
                    <p>Envoyez votre contribution via Wave</p>
                </div>
                <div class="payment-card">
                    <div class="payment-icon">
                        <i class="fas fa-mobile-alt"></i>
                    </div>
                    <h3>Orange Money</h3>
                    <div class="payment-number">78 488 89 04</div>
                    <p>Envoyez votre contribution via Orange Money</p>
                </div>
            </div>
            <p style="text-align: center; margin-top: 2rem; font-style: italic;">
                Infoline : <strong>+221 78 374 89 95</strong> • Email : <strong>aeesssonikara@gmail.com</strong>
            </p>
        </section>

        <section id="contact">
            <div class="section-header">
                <h2><i class="fas fa-phone-alt"></i> Contactez-nous</h2>
                <p class="section-subtitle">N'hésitez pas à nous contacter pour toute information supplémentaire</p>
            </div>
            <div class="action-card" style="max-width: 600px; margin: 0 auto; text-align: center;">
                <p><i class="fas fa-envelope"></i> <strong>Email :</strong> aeesssonikara@gmail.com</p>
                <p><i class="fas fa-phone"></i> <strong>Téléphone :</strong> +221 78 374 89 95</p>
                <p><i class="fas fa-map-marker-alt"></i> <strong>Localisation :</strong> Sanar Peul, Saint-Louis, Sénégal</p>
            </div>
        </section>
    </div>

    <!-- Social Dashboard -->
    <div id="socialDashboard" class="social-dashboard">
        <header class="social-header">
            <div class="social-nav">
                <div class="social-logo">
                    <i class="fas fa-graduation-cap"></i> AEESS Network
                </div>
                <div class="social-search">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" id="searchInput" placeholder="Rechercher..." onkeyup="searchContent()">
                </div>
                <div class="social-actions">
                    <button class="btn btn-primary" onclick="showDashboardSection('feed')">
                        <i class="fas fa-home"></i>
                    </button>
                    <button class="btn btn-secondary" onclick="showDashboardSection('messaging')">
                        <i class="fas fa-comments"></i>
                        <span class="notification-badge" id="messageBadge" style="display: none;">3</span>
                    </button>
                    <button class="btn btn-secondary" onclick="showDashboardSection('documents')">
                        <i class="fas fa-file-alt"></i>
                    </button>
                    <button class="btn btn-secondary" onclick="showDashboardSection('events')">
                        <i class="fas fa-calendar-alt"></i>
                    </button>
                    <button class="btn btn-secondary" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>
            </div>
        </header>

        <main class="social-main">
            <!-- Sidebar gauche -->
            <aside class="sidebar-left">
                <div class="user-profile-card">
                    <div class="user-avatar-big" id="userAvatarBig">U</div>
                    <h3 id="userName">Utilisateur</h3>
                    <p id="userUFR" style="color: #65676b; font-size: 0.9rem;"></p>
                    <div class="quick-actions">
                        <div class="quick-action-card" onclick="showDashboardSection('profile')">
                            <div class="quick-action-icon">
                                <i class="fas fa-user-edit"></i>
                            </div>
                            <div>Modifier profil</div>
                        </div>
                        <div class="quick-action-card" onclick="showDashboardSection('stats')">
                            <div class="quick-action-icon">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <div>Statistiques</div>
                        </div>
                    </div>
                </div>
                <ul class="sidebar-menu">
                    <li><a href="#" onclick="showDashboardSection('feed')" class="active">
                        <i class="fas fa-home"></i> Fil d'actualité
                    </a></li>
                    <li><a href="#" onclick="showDashboardSection('profile')">
                        <i class="fas fa-user"></i> Mon profil
                    </a></li>
                    <li><a href="#" onclick="showDashboardSection('documents')">
                        <i class="fas fa-file-alt"></i> Documents
                    </a></li>
                    <li><a href="#" onclick="showDashboardSection('events')">
                        <i class="fas fa-calendar-alt"></i> Événements
                    </a></li>
                    <li><a href="#" onclick="showDashboardSection('mentorship')">
                        <i class="fas fa-hands-helping"></i> Mentorat
                    </a></li>
                    <li><a href="#" onclick="showDashboardSection('messaging')">
                        <i class="fas fa-comments"></i> Messagerie
                        <span class="notification-badge" id="sidebarMessageBadge" style="display: none;">3</span>
                    </a></li>
                    <li><a href="#" onclick="showDashboardSection('stats')">
                        <i class="fas fa-chart-bar"></i> Statistiques
                    </a></li>
                </ul>
            </aside>

            <!-- Feed central -->
            <section class="news-feed" id="feedSection">
                <div class="create-post-card">
                    <div class="post-input-container">
                        <div class="post-avatar-small" id="userAvatarSmall">U</div>
                        <div class="post-input" onclick="showPostModal()">
                            Quoi de neuf ?
                        </div>
                    </div>
                    <div class="post-actions-grid">
                        <button class="post-action-btn" onclick="showPostModal()">
                            <i class="fas fa-image"></i> Photo
                        </button>
                        <button class="post-action-btn" onclick="showPostModal()">
                            <i class="fas fa-file"></i> Document
                        </button>
                        <button class="post-action-btn" onclick="showPostModal()">
                            <i class="fas fa-calendar-plus"></i> Événement
                        </button>
                    </div>
                </div>

                <div id="socialPostsContainer">
                    <div class="spinner"></div>
                </div>

                <!-- Pagination -->
                <div class="pagination" id="paginationContainer" style="display: none;">
                    <button class="pagination-btn" id="prevPage" onclick="changePage(-1)">Précédent</button>
                    <span class="pagination-info" id="pageInfo">Page 1 sur 1</span>
                    <button class="pagination-btn" id="nextPage" onclick="changePage(1)">Suivant</button>
                </div>
            </section>

            <!-- Sidebar droite -->
            <aside class="sidebar-right">
                <div class="sidebar-section">
                    <div class="sidebar-title">
                        <i class="fas fa-calendar-alt"></i> Événements à venir
                    </div>
                    <div id="upcomingEventsList">
                        <p style="color: #65676b; font-size: 0.9rem;">Chargement...</p>
                    </div>
                </div>

                <div class="sidebar-section">
                    <div class="sidebar-title">
                        <i class="fas fa-users"></i> Membres suggérés
                    </div>
                    <div id="suggestedUsers">
                        <p style="color: #65676b; font-size: 0.9rem;">Chargement...</p>
                    </div>
                </div>

                <div class="sidebar-section">
                    <div class="sidebar-title">
                        <i class="fas fa-chart-line"></i> Activité récente
                    </div>
                    <div id="recentActivity">
                        <p style="color: #65676b; font-size: 0.9rem;">Chargement...</p>
                    </div>
                </div>
            </aside>
        </main>
    </div>

    <!-- Post Modal -->
    <div id="postModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Créer une publication</h3>
                <button class="close-btn" onclick="closePostModal()">×</button>
            </div>
            <div>
                <div class="post-input-container">
                    <div class="post-avatar-small" id="modalUserAvatar">U</div>
                    <div>
                        <strong id="modalUserName">Utilisateur</strong>
                        <div style="font-size: 0.85rem; color: #65676b; margin-top: 0.2rem;">
                            <i class="fas fa-globe-americas"></i> Public
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <textarea id="postContent" placeholder="Quoi de neuf ?" rows="5" style="border: none; font-size: 1.1rem;"></textarea>
                </div>
                <div id="postPreview"></div>
            </div>
            <div class="modal-footer">
                <div class="post-options">
                    <button class="post-option-btn" onclick="triggerFileInput('image')" title="Photo">
                        <i class="fas fa-image"></i>
                    </button>
                    <button class="post-option-btn" onclick="triggerFileInput('document')" title="Document">
                        <i class="fas fa-file"></i>
                    </button>
                </div>
                <button class="btn btn-primary" onclick="createSocialPost()">Publier</button>
            </div>
        </div>
    </div>

    <!-- Login Modal -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Connexion</h3>
                <button class="close-btn" onclick="closeModal()">×</button>
            </div>
            <form onsubmit="login(event)">
                <div class="form-group">
                    <label><i class="fas fa-envelope"></i> Email</label>
                    <input type="email" id="loginEmail" required>
                </div>
                <div class="form-group">
                    <label><i class="fas fa-lock"></i> Mot de passe</label>
                    <input type="password" id="loginPassword" required>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">
                    <i class="fas fa-sign-in-alt"></i> Se connecter
                </button>
                <p style="text-align: center; margin-top: 1rem;">
                    Pas encore membre ? <a href="#" onclick="showRegister()" style="color: var(--primary-green);">S'inscrire</a>
                </p>
            </form>
        </div>
    </div>

    <!-- Register Modal -->
    <div id="registerModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Inscription</h3>
                <button class="close-btn" onclick="closeModal()">×</button>
            </div>
            <form onsubmit="register(event)">
                <div class="form-group">
                    <label><i class="fas fa-user"></i> Nom complet</label>
                    <input type="text" id="registerName" required>
                </div>
                <div class="form-group">
                    <label><i class="fas fa-envelope"></i> Email</label>
                    <input type="email" id="registerEmail" required>
                </div>
                <div class="form-group">
                    <label><i class="fas fa-lock"></i> Mot de passe</label>
                    <input type="password" id="registerPassword" required minlength="6">
                </div>
                <div class="form-group">
                    <label><i class="fas fa-phone"></i> Téléphone</label>
                    <input type="tel" id="registerPhone" required>
                </div>
                <div class="form-group">
                    <label><i class="fas fa-university"></i> UFR</label>
                    <select id="registerUFR" required>
                        <option value="">Sélectionner</option>
                        <option value="SAT">Sciences Appliquées et Technologie</option>
                        <option value="LSH">Lettres et Sciences Humaines</option>
                        <option value="SEG">Sciences Économiques et Gestion</option>
                        <option value="SJP">Sciences Juridiques et Politiques</option>
                    </select>
                </div>
                <div class="form-group">
                    <label><i class="fas fa-graduation-cap"></i> Année d'études</label>
                    <select id="registerYear" required>
                        <option value="">Sélectionner</option>
                        <option value="L1">Licence 1</option>
                        <option value="L2">Licence 2</option>
                        <option value="L3">Licence 3</option>
                        <option value="M1">Master 1</option>
                        <option value="M2">Master 2</option>
                    </select>
                </div>
                <div class="form-group">
                    <label><i class="fas fa-user-tag"></i> Statut</label>
                    <select id="registerStatus" required>
                        <option value="">Sélectionner</option>
                        <option value="nouveau">Nouveau bachelier</option>
                        <option value="ancien">Ancien étudiant</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">
                    <i class="fas fa-user-plus"></i> S'inscrire
                </button>
                <p style="text-align: center; margin-top: 1rem;">
                    Déjà membre ? <a href="#" onclick="showLogin()" style="color: var(--primary-green);">Se connecter</a>
                </p>
            </form>
        </div>
    </div>

    <!-- Messaging Modal -->
    <div id="messagingModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h3>Messagerie</h3>
                <button class="close-btn" onclick="closeMessagingModal()">×</button>
            </div>
            <div class="messaging-container" style="display: flex; height: 500px;">
                <div class="conversation-list" style="width: 300px;">
                    <div class="conversation-item active">
                        <strong>Admin AEESS</strong>
                        <p style="font-size: 0.8rem; color: #65676b;">Dernier message...</p>
                    </div>
                    <!-- Plus de conversations -->
                </div>
                <div style="flex: 1; display: flex; flex-direction: column;">
                    <div class="message-container" id="messageContainer">
                        <!-- Messages chargés dynamiquement -->
                    </div>
                    <div style="padding: 1rem; border-top: 1px solid var(--border);">
                        <input type="text" id="messageInput" placeholder="Tapez votre message..." style="width: 100%; padding: 0.75rem; border: 1px solid var(--border); border-radius: 24px;">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <input type="file" id="fileInput" style="display: none;" accept="image/*,.pdf,.doc,.docx" onchange="handleFileSelect(event)">

    <footer>
        <div class="footer-content">
            <div class="footer-links">
                <a href="#accueil">Accueil</a>
                <a href="#apropos">À propos</a>
                <a href="#dons">Soutenez-nous</a>
                <a href="#contact">Contact</a>
            </div>
            <p>&copy; 2025 AEESS - Association des Élèves et Étudiants Soninké à Saint-Louis</p>
            <p>Soninkara djiké na rémou nè</p>
        </div>
    </footer>

    <script>
        // Initialize Supabase
        const SUPABASE_URL = 'https://wshjyzkwcmlqmldrmjrh.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndzaGp5emt3Y21scW1sZHJtanJoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE4NTcxODYsImV4cCI6MjA3NzQzMzE4Nn0.VzxNLTXg9bUZNUgZF-bqXEefjVNTcIIT-Svgi1nDSyo';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        let currentUser = null;
        let selectedFile = null;
        let currentPage = 1;
        const postsPerPage = 10;

        // NOUVELLES FONCTIONNALITÉS

        // Système de notifications
        function showNotification(message, type = 'info', duration = 5000) {
            const container = document.getElementById('notificationContainer');
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            
            const icons = {
                error: 'fas fa-exclamation-circle',
                warning: 'fas fa-exclamation-triangle',
                success: 'fas fa-check-circle',
                info: 'fas fa-info-circle'
            };

            notification.innerHTML = `
                <i class="${icons[type]} notification-icon"></i>
                <div class="notification-content">${message}</div>
                <button class="notification-close" onclick="this.parentElement.remove()">
                    <i class="fas fa-times"></i>
                </button>
            `;

            container.appendChild(notification);

            if (duration > 0) {
                setTimeout(() => {
                    if (notification.parentElement) {
                        notification.remove();
                    }
                }, duration);
            }
        }

        // Validation de sécurité
        function validatePost(content) {
            if (content.length > 1000) {
                throw new Error("Le post ne peut pas dépasser 1000 caractères");
            }
            if (content.trim().length === 0) {
                throw new Error("Le post ne peut pas être vide");
            }
            // Nettoyage XSS avec DOMPurify
            return DOMPurify.sanitize(content);
        }

        // Pagination améliorée
        async function loadSocialPosts(page = 1) {
            const from = (page - 1) * postsPerPage;
            const to = from + postsPerPage - 1;

            const { data, error, count } = await supabase
                .from('posts')
                .select('*, likes(count), comments(count)', { count: 'exact' })
                .order('created_at', { ascending: false })
                .range(from, to);

            const container = document.getElementById('socialPostsContainer');
            const pagination = document.getElementById('paginationContainer');
            
            if (error) {
                showNotification('Erreur lors du chargement des posts', 'error');
                container.innerHTML = '<div class="post-card" style="text-align: center; padding: 3rem;"><p>Erreur de chargement.</p></div>';
                return;
            }

            if (!data || data.length === 0) {
                container.innerHTML = '<div class="post-card" style="text-align: center; padding: 3rem;"><p>Aucune publication.</p></div>';
                pagination.style.display = 'none';
                return;
            }

            // Afficher la pagination si nécessaire
            const totalPages = Math.ceil(count / postsPerPage);
            if (totalPages > 1) {
                pagination.style.display = 'flex';
                document.getElementById('pageInfo').textContent = `Page ${page} sur ${totalPages}`;
                document.getElementById('prevPage').disabled = page <= 1;
                document.getElementById('nextPage').disabled = page >= totalPages;
            } else {
                pagination.style.display = 'none';
            }

            container.innerHTML = '';
            for (const post of data) {
                const card = await createPostCard(post);
                container.appendChild(card);
            }
        }

        function changePage(direction) {
            currentPage += direction;
            loadSocialPosts(currentPage);
        }

        // Gestion des erreurs globale
        window.addEventListener('error', (e) => {
            console.error('Erreur globale:', e.error);
            showNotification('Une erreur inattendue est survenue', 'error');
        });

        // Vérification de l'authentification en temps réel
        supabase.auth.onAuthStateChange((event, session) => {
            if (event === 'SIGNED_IN' && session) {
                currentUser = session.user;
                showSocialDashboard();
                showNotification('Connexion réussie!', 'success');
            } else if (event === 'SIGNED_OUT') {
                currentUser = null;
                showNotification('Déconnexion réussie', 'info');
            }
        });

        // FONCTIONS EXISTANTES AVEC AMÉLIORATIONS

        // Check auth
        async function checkAuth() {
            try {
                const { data: { session } } = await supabase.auth.getSession();
                if (session) {
                    currentUser = session.user;
                    showSocialDashboard();
                }
            } catch (error) {
                console.error('Erreur de vérification auth:', error);
            }
        }

        // Modal functions
        function showLogin() {
            closeModal();
            document.getElementById('loginModal').classList.add('active');
        }

        function showRegister() {
            closeModal();
            document.getElementById('registerModal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('loginModal').classList.remove('active');
            document.getElementById('registerModal').classList.remove('active');
        }

        function showPostModal() {
            document.getElementById('postModal').classList.add('active');
        }

        function closePostModal() {
            document.getElementById('postModal').classList.remove('active');
            document.getElementById('postContent').value = '';
            document.getElementById('postPreview').innerHTML = '';
            selectedFile = null;
        }

        // Login avec meilleure gestion d'erreurs
        async function login(e) {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            try {
                const { data, error } = await supabase.auth.signInWithPassword({ email, password });

                if (error) throw error;
                
                currentUser = data.user;
                closeModal();
                showSocialDashboard();
                showNotification('Connexion réussie!', 'success');
            } catch (error) {
                showNotification('Erreur de connexion: ' + error.message, 'error');
            }
        }

        // Register avec validation améliorée
        async function register(e) {
            e.preventDefault();
            
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const fullName = document.getElementById('registerName').value;

            // Validation basique
            if (password.length < 6) {
                showNotification('Le mot de passe doit contenir au moins 6 caractères', 'warning');
                return;
            }

            try {
                const { data, error } = await supabase.auth.signUp({
                    email,
                    password,
                    options: {
                        data: {
                            full_name: fullName,
                            phone: document.getElementById('registerPhone').value,
                            ufr: document.getElementById('registerUFR').value,
                            year: document.getElementById('registerYear').value,
                            status: document.getElementById('registerStatus').value
                        }
                    }
                });

                if (error) throw error;

                showNotification('Inscription réussie! Vérifiez votre email.', 'success');
                closeModal();
            } catch (error) {
                showNotification('Erreur d\'inscription: ' + error.message, 'error');
            }
        }

        // Logout
        async function logout() {
            try {
                await supabase.auth.signOut();
                currentUser = null;
                document.getElementById('publicContent').style.display = 'block';
                document.getElementById('socialDashboard').classList.remove('active');
                document.getElementById('loginBtn').classList.remove('hidden');
                showNotification('Déconnexion réussie', 'info');
            } catch (error) {
                showNotification('Erreur lors de la déconnexion', 'error');
            }
        }

        // Show dashboard
        function showSocialDashboard() {
            document.getElementById('publicContent').style.display = 'none';
            document.getElementById('socialDashboard').classList.add('active');
            document.getElementById('loginBtn').classList.add('hidden');
            
            loadUserProfile();
            loadSocialPosts();
            loadUpcomingEvents();
            loadSuggestedUsers();
            loadRecentActivity();
        }

        // Load user profile
        function loadUserProfile() {
            const name = currentUser.user_metadata.full_name || 'Utilisateur';
            const initial = name.charAt(0).toUpperCase();
            
            document.getElementById('userAvatarBig').textContent = initial;
            document.getElementById('userAvatarSmall').textContent = initial;
            document.getElementById('modalUserAvatar').textContent = initial;
            document.getElementById('userName').textContent = name;
            document.getElementById('modalUserName').textContent = name;
            document.getElementById('userUFR').textContent = (currentUser.user_metadata.ufr || '') + ' • ' + (currentUser.user_metadata.year || '');
        }

        // Dashboard sections
        function showDashboardSection(section) {
            // Cacher toutes les sections
            const sections = ['feed', 'documents', 'events', 'profile', 'mentorship', 'messaging', 'stats'];
            sections.forEach(sec => {
                const element = document.getElementById(sec + 'Section');
                if (element) element.classList.add('hidden');
            });

            // Mettre à jour le menu actif
            document.querySelectorAll('.sidebar-menu a').forEach(a => a.classList.remove('active'));
            event.target.classList.add('active');

            if (section === 'feed') {
                document.getElementById('feedSection').classList.remove('hidden');
                loadSocialPosts();
            } else if (section === 'documents') {
                // À implémenter
                showNotification('Section documents en développement', 'info');
            } else if (section === 'events') {
                // À implémenter
                showNotification('Section événements en développement', 'info');
            } else if (section === 'profile') {
                // À implémenter
                showNotification('Section profil en développement', 'info');
            } else if (section === 'mentorship') {
                loadMentorship();
            } else if (section === 'messaging') {
                showMessagingModal();
            } else if (section === 'stats') {
                loadStats();
            }
        }

        // File handling
        function triggerFileInput(type) {
            const input = document.getElementById('fileInput');
            input.accept = type === 'image' ? 'image/*' : '.pdf,.doc,.docx';
            input.click();
        }

        function handleFileSelect(e) {
            selectedFile = e.target.files[0];
            if (!selectedFile) return;

            // Validation de la taille du fichier
            if (selectedFile.size > 10 * 1024 * 1024) { // 10MB
                showNotification('Le fichier est trop volumineux (max 10MB)', 'error');
                return;
            }

            const preview = document.getElementById('postPreview');
            if (selectedFile.type.startsWith('image/')) {
                preview.innerHTML = `<img src="${URL.createObjectURL(selectedFile)}" style="max-width: 100%; border-radius: 8px;">`;
            } else {
                preview.innerHTML = `<div style="padding: 1rem; background: var(--bg-light); border-radius: 8px;">
                    <i class="fas fa-file" style="font-size: 2rem; margin-right: 0.5rem;"></i>
                    <strong>${selectedFile.name}</strong>
                    <div style="font-size: 0.8rem; color: #65676b; margin-top: 0.5rem;">
                        ${(selectedFile.size / 1024 / 1024).toFixed(2)} MB
                    </div>
                </div>`;
            }
        }

        // Create post avec validation
        async function createSocialPost() {
            let content;
            try {
                content = validatePost(document.getElementById('postContent').value.trim());
            } catch (error) {
                showNotification(error.message, 'error');
                return;
            }

            if (!content && !selectedFile) {
                showNotification('Veuillez ajouter du contenu ou un fichier', 'warning');
                return;
            }

            let fileUrl = null;
            let fileType = null;

            try {
                if (selectedFile) {
                    const fileName = `${currentUser.id}/${Date.now()}_${selectedFile.name}`;
                    const { error: uploadError } = await supabase.storage
                        .from('documents')
                        .upload(fileName, selectedFile);

                    if (uploadError) throw uploadError;

                    const { data: urlData } = supabase.storage.from('documents').getPublicUrl(fileName);
                    fileUrl = urlData.publicUrl;
                    fileType = selectedFile.type.startsWith('image/') ? 'image' : 'document';
                }

                const { error } = await supabase.from('posts').insert([{
                    user_id: currentUser.id,
                    author_name: currentUser.user_metadata.full_name,
                    content: content,
                    media_url: fileUrl,
                    media_type: fileType
                }]);

                if (error) throw error;

                showNotification('Publication créée avec succès!', 'success');
                closePostModal();
                loadSocialPosts(currentPage);
            } catch (error) {
                showNotification('Erreur lors de la publication: ' + error.message, 'error');
            }
        }

        // Create post card (version améliorée)
        async function createPostCard(post) {
            const card = document.createElement('div');
            card.className = 'post-card';
            
            const initial = post.author_name ? post.author_name.charAt(0).toUpperCase() : 'U';
            const timeAgo = getTimeAgo(new Date(post.created_at));
            
            // Chargement asynchrone des données associées
            const [commentsData, likesData, userLikeData] = await Promise.all([
                supabase.from('comments').select('*').eq('post_id', post.id),
                supabase.from('likes').select('*').eq('post_id', post.id),
                supabase.from('likes').select('*').eq('post_id', post.id).eq('user_id', currentUser.id).single()
            ]);
            
            const comments = commentsData.data || [];
            const likes = likesData.data || [];
            const userLike = userLikeData.data;

            // Vérification des droits de modération (exemple basique)
            const canModerate = currentUser.user_metadata.status === 'ancien'; // Les anciens peuvent modérer

            card.innerHTML = `
                <div class="post-header">
                    <div style="position: relative;">
                        <div class="post-avatar-small">${initial}</div>
                        <div class="online-indicator"></div>
                    </div>
                    <div class="post-user-info">
                        <h4>${post.author_name || 'Utilisateur'}</h4>
                        <div class="post-meta">${timeAgo}</div>
                    </div>
                    ${canModerate ? `
                        <div class="moderation-actions">
                            <button class="mod-btn delete" onclick="moderatePost('${post.id}', 'delete')" title="Supprimer">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    ` : ''}
                </div>
                <div class="post-content">
                    <p>${post.content.replace(/\n/g, '<br>')}</p>
                    ${post.media_url ? (post.media_type === 'image' ? 
                        `<img src="${post.media_url}" class="post-image" loading="lazy">` : 
                        `<div style="padding: 1rem; background: var(--bg-light); border-radius: 8px; margin-top: 1rem; text-align: center;">
                            <i class="fas fa-file" style="font-size: 2rem; margin-bottom: 0.5rem;"></i>
                            <div><a href="${post.media_url}" target="_blank">Télécharger le document</a></div>
                        </div>`) : ''}
                </div>
                <div class="post-stats">
                    <span><i class="fas fa-thumbs-up"></i> ${likes.length} j'aime</span>
                    <span><i class="fas fa-comment"></i> ${comments.length} commentaires</span>
                </div>
                <div class="post-actions-buttons">
                    <button class="post-action-button ${userLike ? 'liked' : ''}" onclick="toggleLike('${post.id}')">
                        <i class="fas fa-thumbs-up"></i> J'aime
                    </button>
                    <button class="post-action-button" onclick="toggleComments('${post.id}')">
                        <i class="fas fa-comment"></i> Commenter
                    </button>
                    <button class="post-action-button">
                        <i class="fas fa-share"></i> Partager
                    </button>
                </div>
                <div id="comments-${post.id}" class="comments-section hidden">
                    <div class="comment-input-container">
                        <div class="comment-avatar">${currentUser.user_metadata.full_name ? currentUser.user_metadata.full_name.charAt(0).toUpperCase() : 'U'}</div>
                        <input type="text" class="comment-input" placeholder="Commenter..." onkeypress="if(event.key==='Enter') addComment('${post.id}', this.value, this)">
                    </div>
                    <div class="comment-list" id="comments-list-${post.id}"></div>
                </div>
            `;
            
            if (comments.length > 0) {
                setTimeout(() => loadComments(post.id), 100);
            }
            
            return card;
        }

        // Toggle like avec feedback
        async function toggleLike(postId) {
            try {
                const { data: existing } = await supabase
                    .from('likes')
                    .select('*')
                    .eq('post_id', postId)
                    .eq('user_id', currentUser.id)
                    .single();

                if (existing) {
                    await supabase.from('likes').delete().eq('post_id', postId).eq('user_id', currentUser.id);
                    showNotification('Like retiré', 'info');
                } else {
                    await supabase.from('likes').insert([{ post_id: postId, user_id: currentUser.id }]);
                    showNotification('Post liké!', 'success');
                }
                
                loadSocialPosts(currentPage);
            } catch (error) {
                showNotification('Erreur lors du like', 'error');
            }
        }

        // Toggle comments
        function toggleComments(postId) {
            document.getElementById(`comments-${postId}`).classList.toggle('hidden');
        }

        // Add comment avec validation
        async function addComment(postId, content, input) {
            if (!content.trim()) {
                showNotification('Le commentaire ne peut pas être vide', 'warning');
                return;
            }

            try {
                const validatedContent = validatePost(content);
                
                const { error } = await supabase.from('comments').insert([{
                    post_id: postId,
                    user_id: currentUser.id,
                    author_name: currentUser.user_metadata.full_name,
                    content: validatedContent
                }]);

                if (error) throw error;

                input.value = '';
                showNotification('Commentaire ajouté!', 'success');
                loadComments(postId);
                loadSocialPosts(currentPage); // Recharger pour mettre à jour le compteur
            } catch (error) {
                showNotification('Erreur: ' + error.message, 'error');
            }
        }

        // Load comments
        async function loadComments(postId) {
            try {
                const { data } = await supabase
                    .from('comments')
                    .select('*')
                    .eq('post_id', postId)
                    .order('created_at', { ascending: true });

                const container = document.getElementById(`comments-list-${postId}`);
                if (!data || data.length === 0) {
                    container.innerHTML = '';
                    return;
                }

                container.innerHTML = data.map(c => {
                    const initial = c.author_name ? c.author_name.charAt(0).toUpperCase() : 'U';
                    return `
                        <div class="comment-item">
                            <div class="comment-avatar">${initial}</div>
                            <div>
                                <div class="comment-bubble">
                                    <div class="comment-author">${c.author_name || 'Utilisateur'}</div>
                                    <div class="comment-text">${c.content}</div>
                                </div>
                                <div class="comment-time">${getTimeAgo(new Date(c.created_at))}</div>
                            </div>
                        </div>
                    `;
                }).join('');
            } catch (error) {
                console.error('Erreur chargement commentaires:', error);
            }
        }

        // Load upcoming events (sidebar)
        async function loadUpcomingEvents() {
            try {
                const { data } = await supabase
                    .from('events')
                    .select('*')
                    .gte('event_date', new Date().toISOString())
                    .order('event_date', { ascending: true })
                    .limit(3);

                const container = document.getElementById('upcomingEventsList');
                
                if (!data || data.length === 0) {
                    container.innerHTML = '<p style="color: #65676b; font-size: 0.9rem;">Aucun événement programmé</p>';
                    return;
                }

                container.innerHTML = data.map(e => {
                    const d = new Date(e.event_date);
                    return `
                        <div class="event-item">
                            <div class="event-date">
                                <div class="event-day">${d.getDate()}</div>
                                <div class="event-month">${d.toLocaleDateString('fr-FR', { month: 'short' }).toUpperCase()}</div>
                            </div>
                            <div class="event-details">
                                <h4>${e.title}</h4>
                                <p><i class="fas fa-clock"></i> ${d.toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' })}</p>
                            </div>
                        </div>
                    `;
                }).join('');
            } catch (error) {
                console.error('Erreur chargement événements:', error);
            }
        }

        // Load suggested users
        async function loadSuggestedUsers() {
            try {
                const { data } = await supabase
                    .from('profiles')
                    .select('*')
                    .neq('id', currentUser.id)
                    .limit(5);

                const container = document.getElementById('suggestedUsers');
                
                if (!data || data.length === 0) {
                    container.innerHTML = '<p style="color: #65676b; font-size: 0.9rem;">Aucune suggestion</p>';
                    return;
                }

                container.innerHTML = data.map(u => {
                    const initial = u.full_name ? u.full_name.charAt(0).toUpperCase() : 'U';
                    return `
                        <div class="user-suggestion">
                            <div class="post-avatar-small">${initial}</div>
                            <div class="suggestion-info">
                                <div class="suggestion-name">${u.full_name || 'Utilisateur'}</div>
                                <div class="suggestion-meta">${u.ufr || ''} • ${u.year || ''}</div>
                            </div>
                            <button class="add-friend-btn">Ajouter</button>
                        </div>
                    `;
                }).join('');
            } catch (error) {
                console.error('Erreur chargement suggestions:', error);
            }
        }

        // Load recent activity
        async function loadRecentActivity() {
            const container = document.getElementById('recentActivity');
            container.innerHTML = `
                <div style="font-size: 0.9rem;">
                    <div style="padding: 0.5rem 0; border-bottom: 1px solid var(--border);">
                        <i class="fas fa-user-plus" style="color: var(--success);"></i>
                        <span>Nouveau membre inscrit</span>
                    </div>
                    <div style="padding: 0.5rem 0; border-bottom: 1px solid var(--border);">
                        <i class="fas fa-calendar-check" style="color: var(--info);"></i>
                        <span>Événement créé</span>
                    </div>
                    <div style="padding: 0.5rem 0;">
                        <i class="fas fa-file-upload" style="color: var(--warning);"></i>
                        <span>Document partagé</span>
                    </div>
                </div>
            `;
        }

        // Load mentorship
        async function loadMentorship() {
            // Implémentation existante...
        }

        // Load stats
        async function loadStats() {
            showNotification('Section statistiques en développement', 'info');
        }

        // Messaging
        function showMessagingModal() {
            document.getElementById('messagingModal').classList.add('active');
        }

        function closeMessagingModal() {
            document.getElementById('messagingModal').classList.remove('active');
        }

        // Modération
        async function moderatePost(postId, action) {
            if (!confirm('Êtes-vous sûr de vouloir supprimer ce post ?')) return;

            try {
                const { error } = await supabase.from('posts').delete().eq('id', postId);
                if (error) throw error;
                
                showNotification('Post supprimé avec succès', 'success');
                loadSocialPosts(currentPage);
            } catch (error) {
                showNotification('Erreur lors de la suppression', 'error');
            }
        }

        // Search content
        function searchContent() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            if (!query) {
                loadSocialPosts(currentPage);
                return;
            }

            const posts = document.querySelectorAll('.post-card');
            posts.forEach(post => {
                const content = post.textContent.toLowerCase();
                post.style.display = content.includes(query) ? 'block' : 'none';
            });
        }

        // Utility functions
        function getTimeAgo(date) {
            const seconds = Math.floor((new Date() - date) / 1000);
            
            let interval = seconds / 31536000;
            if (interval > 1) return Math.floor(interval) + " an" + (Math.floor(interval) > 1 ? "s" : "");
            
            interval = seconds / 2592000;
            if (interval > 1) return Math.floor(interval) + " mois";
            
            interval = seconds / 86400;
            if (interval > 1) return Math.floor(interval) + " j";
            
            interval = seconds / 3600;
            if (interval > 1) return Math.floor(interval) + " h";
            
            interval = seconds / 60;
            if (interval > 1) return Math.floor(interval) + " min";
            
            return "À l'instant";
        }

        // Close modal on outside click
        window.onclick = function(e) {
            if (e.target.classList.contains('modal')) {
                e.target.classList.remove('active');
            }
        }

        // Initialize
        checkAuth();

        // Service Worker pour le cache (PWA)
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js')
                .then(() => console.log('Service Worker enregistré'))
                .catch(err => console.log('Erreur Service Worker:', err));
        }
    </script>
</body>
</html>
