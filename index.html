<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AEESS - Réseau Étudiant</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-green: #2d7a3e;
            --light-green: #4a9d5f;
            --dark-green: #1a5229;
            --bg-light: #f0f2f5;
            --white: #ffffff;
            --text-dark: #333;
            --border: #e4e6eb;
            --hover-bg: #f2f3f5;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            line-height: 1.6;
            color: var(--text-dark);
            background: var(--bg-light);
        }

        /* Navigation */
        nav {
            background: var(--white);
            padding: 0.5rem 1rem;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border-bottom: 1px solid var(--border);
        }

        .nav-container {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.4rem;
            font-weight: bold;
            color: var(--primary-green);
        }

        .nav-links {
            display: flex;
            gap: 1rem;
            list-style: none;
        }

        .nav-links a {
            color: var(--text-dark);
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            transition: background 0.2s;
        }

        .nav-links a:hover {
            background: var(--hover-bg);
        }

        .btn {
            padding: 0.6rem 1.2rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 600;
            transition: all 0.2s;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary {
            background: var(--primary-green);
            color: var(--white);
        }

        .btn-primary:hover {
            background: var(--dark-green);
        }

        .btn-secondary {
            background: var(--bg-light);
            color: var(--primary-green);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            background: var(--hover-bg);
        }

        /* Hero Section */
        .hero {
            background: linear-gradient(135deg, var(--primary-green) 0%, var(--dark-green) 100%);
            color: var(--white);
            padding: 4rem 2rem;
            text-align: center;
        }

        .hero h1 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }

        .hero-stats {
            display: flex;
            justify-content: center;
            gap: 3rem;
            margin-top: 2rem;
            flex-wrap: wrap;
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
        }

        /* Sections publiques */
        section {
            padding: 4rem 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        h2 {
            color: var(--primary-green);
            font-size: 2rem;
            margin-bottom: 2rem;
            text-align: center;
        }

        .actions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }

        .action-card {
            background: var(--white);
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border: 1px solid var(--border);
        }

        .crisis-alert {
            background: #fff3cd;
            border-left: 5px solid #ffc107;
            padding: 2rem;
            margin: 2rem 0;
            border-radius: 8px;
        }

        .payment-card {
            background: var(--white);
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            text-align: center;
            border: 1px solid var(--border);
        }

        .payment-number {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary-green);
            margin: 1rem 0;
        }

        /* Espace Réseau Social */
        .social-dashboard {
            display: none;
            background: var(--bg-light);
            min-height: 100vh;
        }

        .social-dashboard.active {
            display: block;
        }

        .social-header {
            background: var(--white);
            padding: 1rem 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .social-nav {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
        }

        .social-logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary-green);
        }

        .social-search {
            flex: 1;
            max-width: 400px;
        }

        .social-search input {
            width: 100%;
            padding: 0.7rem 1rem;
            border: 1px solid #ddd;
            border-radius: 20px;
            font-size: 0.9rem;
        }

        .social-actions {
            display: flex;
            gap: 0.5rem;
        }

        .social-main {
            max-width: 1400px;
            margin: 2rem auto;
            padding: 0 1rem;
            display: grid;
            grid-template-columns: 280px 1fr 320px;
            gap: 2rem;
        }

        /* Sidebar gauche */
        .sidebar-left {
            background: var(--white);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            height: fit-content;
            position: sticky;
            top: 90px;
        }

        .user-profile-card {
            text-align: center;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--border);
            margin-bottom: 1rem;
        }

        .user-avatar-big {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: var(--primary-green);
            color: var(--white);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: bold;
            margin: 0 auto 1rem;
        }

        .sidebar-menu {
            list-style: none;
        }

        .sidebar-menu li {
            margin-bottom: 0.5rem;
        }

        .sidebar-menu a {
            display: flex;
            align-items: center;
            gap: 0.8rem;
            padding: 0.8rem;
            color: var(--text-dark);
            text-decoration: none;
            border-radius: 8px;
            transition: background 0.3s;
        }

        .sidebar-menu a:hover {
            background: var(--hover-bg);
        }

        /* Feed central */
        .news-feed {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .create-post-card {
            background: var(--white);
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .post-input-container {
            display: flex;
            gap: 1rem;
            align-items: center;
            margin-bottom: 1rem;
        }

        .post-avatar-small {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary-green);
            color: var(--white);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
        }

        .post-input {
            flex: 1;
            padding: 1rem;
            border: 1px solid #ddd;
            border-radius: 25px;
            cursor: pointer;
            background: var(--bg-light);
            color: #65676b;
        }

        .post-input:hover {
            background: #e9ecef;
        }

        .post-actions-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.5rem;
            border-top: 1px solid var(--border);
            padding-top: 1rem;
        }

        .post-action-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.7rem;
            border: none;
            background: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.3s;
            color: var(--text-dark);
            font-size: 0.95rem;
        }

        .post-action-btn:hover {
            background: var(--bg-light);
        }

        /* Post Card */
        .post-card {
            background: var(--white);
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .post-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1.5rem 1.5rem 1rem;
        }

        .post-user-info {
            flex: 1;
        }

        .post-user-info h4 {
            margin-bottom: 0.2rem;
        }

        .post-meta {
            font-size: 0.85rem;
            color: #65676b;
        }

        .post-content {
            padding: 0 1.5rem 1rem;
            font-size: 1rem;
            line-height: 1.6;
        }

        .post-image {
            width: 100%;
            max-height: 500px;
            object-fit: cover;
        }

        .post-stats {
            display: flex;
            justify-content: space-between;
            padding: 0.8rem 1.5rem;
            border-top: 1px solid var(--border);
            font-size: 0.9rem;
            color: #65676b;
        }

        .post-actions-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            border-top: 1px solid var(--border);
        }

        .post-action-button {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.8rem;
            border: none;
            background: none;
            cursor: pointer;
            transition: background 0.2s;
            color: var(--text-dark);
            font-weight: 600;
        }

        .post-action-button:hover {
            background: var(--bg-light);
        }

        .post-action-button.liked {
            color: var(--primary-green);
        }

        /* Comments */
        .comments-section {
            padding: 1rem 1.5rem;
            border-top: 1px solid var(--border);
        }

        .comment-input-container {
            display: flex;
            gap: 0.75rem;
            margin-bottom: 1rem;
            align-items: center;
        }

        .comment-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--light-green);
            color: var(--white);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.85rem;
            font-weight: bold;
            flex-shrink: 0;
        }

        .comment-input {
            flex: 1;
            padding: 0.65rem 1rem;
            border: 1px solid var(--border);
            border-radius: 24px;
            background: var(--bg-light);
            font-size: 0.9rem;
            font-family: inherit;
        }

        .comment-input:focus {
            outline: none;
            background: var(--white);
        }

        .comment-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .comment-item {
            display: flex;
            gap: 0.75rem;
            margin-top: 0.75rem;
        }

        .comment-bubble {
            background: var(--bg-light);
            padding: 0.75rem 1rem;
            border-radius: 18px;
            display: inline-block;
        }

        .comment-author {
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: 0.25rem;
        }

        .comment-text {
            font-size: 0.9rem;
        }

        .comment-time {
            font-size: 0.8rem;
            color: #65676b;
            margin-top: 0.25rem;
            padding-left: 1rem;
        }

        /* Sidebar droite */
        .sidebar-right {
            height: fit-content;
            position: sticky;
            top: 90px;
        }

        .sidebar-section {
            background: var(--white);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 1.5rem;
        }

        .sidebar-title {
            font-weight: 600;
            font-size: 1.05rem;
            margin-bottom: 1rem;
            color: var(--text-dark);
        }

        .event-item {
            display: flex;
            gap: 1rem;
            padding: 1rem 0;
            border-bottom: 1px solid var(--border);
        }

        .event-item:last-child {
            border-bottom: none;
        }

        .event-date {
            background: var(--primary-green);
            color: var(--white);
            padding: 0.5rem;
            border-radius: 8px;
            text-align: center;
            min-width: 50px;
        }

        .event-day {
            font-size: 1.2rem;
            font-weight: bold;
        }

        .event-month {
            font-size: 0.8rem;
        }

        .event-details h4 {
            margin-bottom: 0.3rem;
            font-size: 0.95rem;
        }

        .event-details p {
            font-size: 0.85rem;
            color: #65676b;
        }

        .user-suggestion {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--border);
        }

        .user-suggestion:last-child {
            border-bottom: none;
        }

        .suggestion-info {
            flex: 1;
        }

        .suggestion-name {
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: 0.2rem;
        }

        .suggestion-meta {
            font-size: 0.8rem;
            color: #65676b;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--white);
            padding: 2rem;
            border-radius: 12px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border);
        }

        .modal-header h3 {
            font-size: 1.3rem;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.8rem;
            cursor: pointer;
            color: #65676b;
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .close-btn:hover {
            background: var(--bg-light);
        }

        .form-group {
            margin-bottom: 1.2rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            font-size: 0.95rem;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 1rem;
            font-family: inherit;
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        .modal-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 1.5rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border);
        }

        .post-options {
            display: flex;
            gap: 0.5rem;
        }

        .post-option-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 8px;
            transition: background 0.2s;
        }

        .post-option-btn:hover {
            background: var(--bg-light);
        }

        #postPreview {
            margin-top: 1rem;
        }

        #postPreview img {
            max-width: 100%;
            border-radius: 8px;
        }

        .hidden {
            display: none !important;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--primary-green);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 2rem auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .online-indicator {
            width: 10px;
            height: 10px;
            background: #4CAF50;
            border-radius: 50%;
            border: 2px solid var(--white);
            position: absolute;
            bottom: 0;
            right: 0;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .social-main {
                grid-template-columns: 1fr;
            }
            
            .sidebar-left, .sidebar-right {
                display: none;
            }

            .social-actions {
                flex-wrap: wrap;
            }

            .social-actions .btn {
                padding: 0.5rem;
                font-size: 0.85rem;
            }
        }

        @media (max-width: 768px) {
            .nav-links {
                display: none;
            }

            .social-search {
                max-width: 200px;
            }

            .social-actions {
                gap: 0.25rem;
            }
        }

        footer {
            background: var(--dark-green);
            color: var(--white);
            padding: 2rem;
            text-align: center;
            margin-top: 3rem;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav>
        <div class="nav-container">
            <div class="logo">
                🎓 AEESS
            </div>
            <ul class="nav-links" id="publicNav">
                <li><a href="#accueil">Accueil</a></li>
                <li><a href="#apropos">À propos</a></li>
                <li><a href="#dons">Soutenez-nous</a></li>
                <li><a href="#contact">Contact</a></li>
            </ul>
            <div>
                <button class="btn btn-primary" id="loginBtn" onclick="showLogin()">Connexion</button>
            </div>
        </div>
    </nav>

    <!-- Public Content -->
    <div id="publicContent">
        <section class="hero" id="accueil">
            <h1>ENSEMBLE, SOUTENONS NOS ÉTUDIANTS</h1>
            <p>L'Association des Élèves et Étudiants Soninké à Saint-Louis accueille et accompagne les nouveaux bacheliers orientés à l'Université Gaston Berger</p>
            <div class="hero-stats">
                <div class="stat">
                    <div class="stat-number">30+</div>
                    <div style="font-size: 1rem; opacity: 0.9;">Nouveaux étudiants 2025</div>
                </div>
                <div class="stat">
                    <div class="stat-number">280K</div>
                    <div style="font-size: 1rem; opacity: 0.9;">FCFA de caution payée</div>
                </div>
                <div class="stat">
                    <div class="stat-number">10+</div>
                    <div style="font-size: 1rem; opacity: 0.9;">Années d'existence</div>
                </div>
            </div>
            <div style="margin-top: 2rem;">
                <a href="#dons" class="btn btn-secondary" style="margin-right: 1rem;">Faire un don</a>
                <button class="btn btn-primary" onclick="showRegister()">Devenir membre</button>
            </div>
        </section>

        <section id="apropos">
            <h2>À Propos de l'AEESS</h2>
            <div class="crisis-alert">
                <h3>🏠 Notre Mission : Résoudre la Crise du Logement</h3>
                <p>L'UGB manque d'infrastructures. En 2025, nous avons accueilli 30 nouveaux bacheliers. La caution d'un appartement coûte 280 000 FCFA, les loyers varient de 30 000 à 50 000 FCFA/mois. Nous avons prélevé 150 000 FCFA de notre caisse. Sans votre aide, notre mission est compromise.</p>
            </div>
        </section>

        <section id="dons">
            <h2>💚 Soutenez-nous</h2>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 2rem; margin-top: 2rem;">
                <div class="payment-card">
                    <h3>📱 Wave</h3>
                    <div class="payment-number">78 247 74 12</div>
                </div>
                <div class="payment-card">
                    <h3>📱 Orange Money</h3>
                    <div class="payment-number">78 488 89 04</div>
                </div>
            </div>
            <p style="text-align: center; margin-top: 2rem; font-style: italic;">
                Infoline : <strong>+221 78 374 89 95</strong> • Email : <strong>aeesssonikara@gmail.com</strong>
            </p>
        </section>

        <section id="contact">
            <h2>📞 Contactez-nous</h2>
            <div class="action-card" style="max-width: 600px; margin: 0 auto; text-align: center;">
                <p><strong>Email :</strong> aeesssonikara@gmail.com</p>
                <p><strong>Téléphone :</strong> +221 78 374 89 95</p>
                <p><strong>Localisation :</strong> Sanar Peul, Saint-Louis, Sénégal</p>
            </div>
        </section>
    </div>

    <!-- Social Dashboard -->
    <div id="socialDashboard" class="social-dashboard">
        <header class="social-header">
            <div class="social-nav">
                <div class="social-logo">AEESS Network</div>
                <div class="social-search">
                    <input type="text" id="searchInput" placeholder="Rechercher..." onkeyup="searchContent()">
                </div>
                <div class="social-actions">
                    <button class="btn btn-primary" onclick="showDashboardSection('feed')">🏠</button>
                    <button class="btn btn-secondary" onclick="showDashboardSection('documents')">📚</button>
                    <button class="btn btn-secondary" onclick="showDashboardSection('events')">📅</button>
                    <button class="btn btn-secondary" onclick="logout()">🚪</button>
                </div>
            </div>
        </header>

        <main class="social-main">
            <!-- Sidebar gauche -->
            <aside class="sidebar-left">
                <div class="user-profile-card">
                    <div class="user-avatar-big" id="userAvatarBig">U</div>
                    <h3 id="userName">Utilisateur</h3>
                    <p id="userUFR" style="color: #65676b; font-size: 0.9rem;"></p>
                </div>
                <ul class="sidebar-menu">
                    <li><a href="#" onclick="showDashboardSection('feed')"><span>🏠</span> Fil d'actualité</a></li>
                    <li><a href="#" onclick="showDashboardSection('profile')"><span>👤</span> Mon profil</a></li>
                    <li><a href="#" onclick="showDashboardSection('documents')"><span>📚</span> Documents</a></li>
                    <li><a href="#" onclick="showDashboardSection('events')"><span>📅</span> Événements</a></li>
                    <li><a href="#" onclick="showDashboardSection('mentorship')"><span>🤝</span> Mentorat</a></li>
                </ul>
            </aside>

            <!-- Feed central -->
            <section class="news-feed" id="feedSection">
                <div class="create-post-card">
                    <div class="post-input-container">
                        <div class="post-avatar-small" id="userAvatarSmall">U</div>
                        <div class="post-input" onclick="showPostModal()">
                            Quoi de neuf ?
                        </div>
                    </div>
                    <div class="post-actions-grid">
                        <button class="post-action-btn" onclick="showPostModal()">
                            <span>📷</span> Photo
                        </button>
                        <button class="post-action-btn" onclick="showPostModal()">
                            <span>📄</span> Document
                        </button>
                        <button class="post-action-btn" onclick="showPostModal()">
                            <span>📅</span> Événement
                        </button>
                    </div>
                </div>

                <div id="socialPostsContainer">
                    <div class="spinner"></div>
                </div>
            </section>

            <!-- Documents Section (hidden by default) -->
            <section class="news-feed hidden" id="documentsSection">
                <div class="create-post-card">
                    <h3>📤 Ajouter un document</h3>
                    <div class="form-group">
                        <label>Titre</label>
                        <input type="text" id="docTitle" placeholder="Ex: Cours de Mathématiques L1">
                    </div>
                    <div class="form-group">
                        <label>UFR</label>
                        <select id="docUFR">
                            <option value="">Sélectionner UFR</option>
                            <option value="SAT">Sciences Appliquées et Technologie</option>
                            <option value="LSH">Lettres et Sciences Humaines</option>
                            <option value="SEG">Sciences Économiques et Gestion</option>
                            <option value="SJP">Sciences Juridiques et Politiques</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Fichier</label>
                        <input type="file" id="docFile">
                    </div>
                    <button class="btn btn-primary" onclick="uploadDocument()">Télécharger</button>
                </div>
                <div id="documentsGrid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 1rem; margin-top: 1.5rem;">
                    <div class="spinner"></div>
                </div>
            </section>

            <!-- Events Section (hidden by default) -->
            <section class="news-feed hidden" id="eventsSection">
                <div class="create-post-card">
                    <h3>➕ Créer un événement</h3>
                    <div class="form-group">
                        <label>Titre</label>
                        <input type="text" id="eventTitle" placeholder="Ex: Match de football">
                    </div>
                    <div class="form-group">
                        <label>Description</label>
                        <textarea id="eventDesc" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Date</label>
                        <input type="datetime-local" id="eventDate">
                    </div>
                    <div class="form-group">
                        <label>Lieu</label>
                        <input type="text" id="eventLocation">
                    </div>
                    <button class="btn btn-primary" onclick="createEvent()">Créer</button>
                </div>
                <div id="eventsGrid">
                    <div class="spinner"></div>
                </div>
            </section>

            <!-- Profile Section (hidden by default) -->
            <section class="news-feed hidden" id="profileSection">
                <div class="create-post-card">
                    <div style="text-align: center; padding: 1rem;">
                        <div class="user-avatar-big" id="profileAvatar" style="margin: 0 auto 1rem;">U</div>
                        <h2 id="profileName">Utilisateur</h2>
                        <p id="profileStatus" style="color: #65676b;"></p>
                    </div>
                </div>
                <div class="create-post-card" style="margin-top: 1rem;">
                    <h3 style="margin-bottom: 1rem;">Informations</h3>
                    <div id="profileInfo"></div>
                </div>
            </section>

            <!-- Mentorship Section (hidden by default) -->
            <section class="news-feed hidden" id="mentorshipSection">
                <div class="create-post-card">
                    <h3>🤝 Mon Programme de Mentorat</h3>
                    <div id="mentorshipInfo" style="margin-top: 1rem;">
                        <div class="spinner"></div>
                    </div>
                </div>
            </section>

            <!-- Sidebar droite -->
            <aside class="sidebar-right">
                <div class="sidebar-section">
                    <div class="sidebar-title">📅 Événements à venir</div>
                    <div id="upcomingEventsList">
                        <p style="color: #65676b; font-size: 0.9rem;">Chargement...</p>
                    </div>
                </div>

                <div class="sidebar-section">
                    <div class="sidebar-title">👥 Membres suggérés</div>
                    <div id="suggestedUsers">
                        <p style="color: #65676b; font-size: 0.9rem;">Chargement...</p>
                    </div>
                </div>
            </aside>
        </main>
    </div>

    <!-- Post Modal -->
    <div id="postModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Créer une publication</h3>
                <button class="close-btn" onclick="closePostModal()">×</button>
            </div>
            <div>
                <div class="post-input-container">
                    <div class="post-avatar-small" id="modalUserAvatar">U</div>
                    <div>
                        <strong id="modalUserName">Utilisateur</strong>
                        <div style="font-size: 0.85rem; color: #65676b; margin-top: 0.2rem;">🌍 Public</div>
                    </div>
                </div>
                <div class="form-group">
                    <textarea id="postContent" placeholder="Quoi de neuf ?" rows="5" style="border: none; font-size: 1.1rem;"></textarea>
                </div>
                <div id="postPreview"></div>
            </div>
            <div class="modal-footer">
                <div class="post-options">
                    <button class="post-option-btn" onclick="triggerFileInput('image')" title="Photo">
                        <span style="font-size: 1.5rem;">📷</span>
                    </button>
                    <button class="post-option-btn" onclick="triggerFileInput('document')" title="Document">
                        <span style="font-size: 1.5rem;">📄</span>
                    </button>
                </div>
                <button class="btn btn-primary" onclick="createSocialPost()">Publier</button>
            </div>
        </div>
    </div>

    <!-- Login Modal -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Connexion</h3>
                <button class="close-btn" onclick="closeModal()">×</button>
            </div>
            <form onsubmit="login(event)">
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="loginEmail" required>
                </div>
                <div class="form-group">
                    <label>Mot de passe</label>
                    <input type="password" id="loginPassword" required>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">Se connecter</button>
                <p style="text-align: center; margin-top: 1rem;">
                    Pas encore membre ? <a href="#" onclick="showRegister()" style="color: var(--primary-green);">S'inscrire</a>
                </p>
            </form>
        </div>
    </div>

    <!-- Register Modal -->
    <div id="registerModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Inscription</h3>
                <button class="close-btn" onclick="closeModal()">×</button>
            </div>
            <form onsubmit="register(event)">
                <div class="form-group">
                    <label>Nom complet</label>
                    <input type="text" id="registerName" required>
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="registerEmail" required>
                </div>
                <div class="form-group">
                    <label>Mot de passe</label>
                    <input type="password" id="registerPassword" required minlength="6">
                </div>
                <div class="form-group">
                    <label>Téléphone</label>
                    <input type="tel" id="registerPhone" required>
                </div>
                <div class="form-group">
                    <label>UFR</label>
                    <select id="registerUFR" required>
                        <option value="">Sélectionner</option>
                        <option value="SAT">Sciences Appliquées et Technologie</option>
                        <option value="LSH">Lettres et Sciences Humaines</option>
                        <option value="SEG">Sciences Économiques et Gestion</option>
                        <option value="SJP">Sciences Juridiques et Politiques</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Année d'études</label>
                    <select id="registerYear" required>
                        <option value="">Sélectionner</option>
                        <option value="L1">Licence 1</option>
                        <option value="L2">Licence 2</option>
                        <option value="L3">Licence 3</option>
                        <option value="M1">Master 1</option>
                        <option value="M2">Master 2</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Statut</label>
                    <select id="registerStatus" required>
                        <option value="">Sélectionner</option>
                        <option value="nouveau">Nouveau bachelier</option>
                        <option value="ancien">Ancien étudiant</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">S'inscrire</button>
                <p style="text-align: center; margin-top: 1rem;">
                    Déjà membre ? <a href="#" onclick="showLogin()" style="color: var(--primary-green);">Se connecter</a>
                </p>
            </form>
        </div>
    </div>

    <input type="file" id="fileInput" style="display: none;" accept="image/*,.pdf,.doc,.docx" onchange="handleFileSelect(event)">

    <footer>
        <p>&copy; 2025 AEESS - Association des Élèves et Étudiants Soninké à Saint-Louis</p>
        <p>Soninkara djiké na rémou nè</p>
    </footer>

    <script>
        // Initialize Supabase
        const SUPABASE_URL = 'https://wshjyzkwcmlqmldrmjrh.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndzaGp5emt3Y21scW1sZHJtanJoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE4NTcxODYsImV4cCI6MjA3NzQzMzE4Nn0.VzxNLTXg9bUZNUgZF-bqXEefjVNTcIIT-Svgi1nDSyo';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        let currentUser = null;
        let selectedFile = null;

        // Check auth
        async function checkAuth() {
            const { data: { session } } = await supabase.auth.getSession();
            if (session) {
                currentUser = session.user;
                showSocialDashboard();
            }
        }

        // Modal functions
        function showLogin() {
            closeModal();
            document.getElementById('loginModal').classList.add('active');
        }

        function showRegister() {
            closeModal();
            document.getElementById('registerModal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('loginModal').classList.remove('active');
            document.getElementById('registerModal').classList.remove('active');
        }

        function showPostModal() {
            document.getElementById('postModal').classList.add('active');
        }

        function closePostModal() {
            document.getElementById('postModal').classList.remove('active');
            document.getElementById('postContent').value = '';
            document.getElementById('postPreview').innerHTML = '';
            selectedFile = null;
        }

        // Login
        async function login(e) {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            const { data, error } = await supabase.auth.signInWithPassword({ email, password });

            if (error) {
                alert('Erreur: ' + error.message);
            } else {
                currentUser = data.user;
                closeModal();
                showSocialDashboard();
            }
        }

        // Register
        async function register(e) {
            e.preventDefault();
            const { data, error } = await supabase.auth.signUp({
                email: document.getElementById('registerEmail').value,
                password: document.getElementById('registerPassword').value,
                options: {
                    data: {
                        full_name: document.getElementById('registerName').value,
                        phone: document.getElementById('registerPhone').value,
                        ufr: document.getElementById('registerUFR').value,
                        year: document.getElementById('registerYear').value,
                        status: document.getElementById('registerStatus').value
                    }
                }
            });

            if (error) {
                alert('Erreur: ' + error.message);
            } else {
                alert('Inscription réussie! Vérifiez votre email.');
                closeModal();
            }
        }

        // Logout
        async function logout() {
            await supabase.auth.signOut();
            currentUser = null;
            document.getElementById('publicContent').style.display = 'block';
            document.getElementById('socialDashboard').classList.remove('active');
            document.getElementById('loginBtn').classList.remove('hidden');
        }

        // Show dashboard
        function showSocialDashboard() {
            document.getElementById('publicContent').style.display = 'none';
            document.getElementById('socialDashboard').classList.add('active');
            document.getElementById('loginBtn').classList.add('hidden');
            
            loadUserProfile();
            loadSocialPosts();
            loadUpcomingEvents();
            loadSuggestedUsers();
        }

        // Load user profile
        function loadUserProfile() {
            const name = currentUser.user_metadata.full_name || 'Utilisateur';
            const initial = name.charAt(0).toUpperCase();
            
            document.getElementById('userAvatarBig').textContent = initial;
            document.getElementById('userAvatarSmall').textContent = initial;
            document.getElementById('modalUserAvatar').textContent = initial;
            document.getElementById('userName').textContent = name;
            document.getElementById('modalUserName').textContent = name;
            document.getElementById('userUFR').textContent = (currentUser.user_metadata.ufr || '') + ' • ' + (currentUser.user_metadata.year || '');
        }

        // Dashboard sections
        function showDashboardSection(section) {
            document.getElementById('feedSection').classList.add('hidden');
            document.getElementById('documentsSection').classList.add('hidden');
            document.getElementById('eventsSection').classList.add('hidden');
            document.getElementById('profileSection').classList.add('hidden');
            document.getElementById('mentorshipSection').classList.add('hidden');

            if (section === 'feed') {
                document.getElementById('feedSection').classList.remove('hidden');
                loadSocialPosts();
            } else if (section === 'documents') {
                document.getElementById('documentsSection').classList.remove('hidden');
                loadDocuments();
            } else if (section === 'events') {
                document.getElementById('eventsSection').classList.remove('hidden');
                loadEvents();
            } else if (section === 'profile') {
                document.getElementById('profileSection').classList.remove('hidden');
                loadProfile();
            } else if (section === 'mentorship') {
                document.getElementById('mentorshipSection').classList.remove('hidden');
                loadMentorship();
            }
        }

        // File handling
        function triggerFileInput(type) {
            const input = document.getElementById('fileInput');
            input.accept = type === 'image' ? 'image/*' : '.pdf,.doc,.docx';
            input.click();
        }

        function handleFileSelect(e) {
            selectedFile = e.target.files[0];
            if (!selectedFile) return;

            const preview = document.getElementById('postPreview');
            if (selectedFile.type.startsWith('image/')) {
                preview.innerHTML = `<img src="${URL.createObjectURL(selectedFile)}" style="max-width: 100%; border-radius: 8px;">`;
            } else {
                preview.innerHTML = `<div style="padding: 1rem; background: var(--bg-light); border-radius: 8px;">📄 ${selectedFile.name}</div>`;
            }
        }

        // Create post
        async function createSocialPost() {
            const content = document.getElementById('postContent').value.trim();
            if (!content && !selectedFile) {
                alert('Veuillez ajouter du contenu');
                return;
            }

            let fileUrl = null;
            let fileType = null;

            if (selectedFile) {
                const fileName = `${Date.now()}_${selectedFile.name}`;
                const { error: uploadError } = await supabase.storage
                    .from('documents')
                    .upload(fileName, selectedFile);

                if (!uploadError) {
                    const { data: urlData } = supabase.storage.from('documents').getPublicUrl(fileName);
                    fileUrl = urlData.publicUrl;
                    fileType = selectedFile.type.startsWith('image/') ? 'image' : 'document';
                }
            }

            const { error } = await supabase.from('posts').insert([{
                user_id: currentUser.id,
                author_name: currentUser.user_metadata.full_name,
                content: content,
                media_url: fileUrl,
                media_type: fileType
            }]);

            if (error) {
                alert('Erreur: ' + error.message);
            } else {
                closePostModal();
                loadSocialPosts();
            }
        }

        // Load posts
        async function loadSocialPosts() {
            const { data, error } = await supabase
                .from('posts')
                .select('*, likes(count)')
                .order('created_at', { ascending: false });

            const container = document.getElementById('socialPostsContainer');
            
            if (error || !data || data.length === 0) {
                container.innerHTML = '<div class="post-card" style="text-align: center; padding: 3rem;"><p>Aucune publication.</p></div>';
                return;
            }

            container.innerHTML = '';
            for (const post of data) {
                const card = await createPostCard(post);
                container.appendChild(card);
            }
        }

        // Create post card
        async function createPostCard(post) {
            const card = document.createElement('div');
            card.className = 'post-card';
            
            const initial = post.author_name ? post.author_name.charAt(0).toUpperCase() : 'U';
            const timeAgo = getTimeAgo(new Date(post.created_at));
            
            const { data: comments } = await supabase
                .from('comments')
                .select('*')
                .eq('post_id', post.id);
            
            const { data: likes } = await supabase
                .from('likes')
                .select('*')
                .eq('post_id', post.id);
            
            const { data: userLike } = await supabase
                .from('likes')
                .select('*')
                .eq('post_id', post.id)
                .eq('user_id', currentUser.id)
                .single();
            
            card.innerHTML = `
                <div class="post-header">
                    <div style="position: relative;">
                        <div class="post-avatar-small">${initial}</div>
                        <div class="online-indicator"></div>
                    </div>
                    <div class="post-user-info">
                        <h4>${post.author_name || 'Utilisateur'}</h4>
                        <div class="post-meta">${timeAgo}</div>
                    </div>
                </div>
                <div class="post-content">
                    <p>${post.content.replace(/\n/g, '<br>')}</p>
                    ${post.media_url ? (post.media_type === 'image' ? 
                        `<img src="${post.media_url}" class="post-image">` : 
                        `<div style="padding: 1rem; background: var(--bg-light); border-radius: 8px; margin-top: 1rem; text-align: center;">
                            <div style="font-size: 2rem;">📄</div>
                            <a href="${post.media_url}" target="_blank">Télécharger le document</a>
                        </div>`) : ''}
                </div>
                <div class="post-stats">
                    <span>👍 ${likes ? likes.length : 0} j'aime</span>
                    <span>💬 ${comments ? comments.length : 0} commentaires</span>
                </div>
                <div class="post-actions-buttons">
                    <button class="post-action-button ${userLike ? 'liked' : ''}" onclick="toggleLike('${post.id}')">
                        <span>👍</span> J'aime
                    </button>
                    <button class="post-action-button" onclick="toggleComments('${post.id}')">
                        <span>💬</span> Commenter
                    </button>
                    <button class="post-action-button">
                        <span>🔄</span> Partager
                    </button>
                </div>
                <div id="comments-${post.id}" class="comments-section hidden">
                    <div class="comment-input-container">
                        <div class="comment-avatar">${currentUser.user_metadata.full_name ? currentUser.user_metadata.full_name.charAt(0).toUpperCase() : 'U'}</div>
                        <input type="text" class="comment-input" placeholder="Commenter..." onkeypress="if(event.key==='Enter') addComment('${post.id}', this.value, this)">
                    </div>
                    <div class="comment-list" id="comments-list-${post.id}"></div>
                </div>
            `;
            
            if (comments && comments.length > 0) {
                setTimeout(() => loadComments(post.id), 100);
            }
            
            return card;
        }

        // Toggle like
        async function toggleLike(postId) {
            const { data: existing } = await supabase
                .from('likes')
                .select('*')
                .eq('post_id', postId)
                .eq('user_id', currentUser.id)
                .single();

            if (existing) {
                await supabase.from('likes').delete().eq('post_id', postId).eq('user_id', currentUser.id);
            } else {
                await supabase.from('likes').insert([{ post_id: postId, user_id: currentUser.id }]);
            }
            
            loadSocialPosts();
        }

        // Toggle comments
        function toggleComments(postId) {
            document.getElementById(`comments-${postId}`).classList.toggle('hidden');
        }

        // Add comment
        async function addComment(postId, content, input) {
            if (!content.trim()) return;
            
            const { error } = await supabase.from('comments').insert([{
                post_id: postId,
                user_id: currentUser.id,
                author_name: currentUser.user_metadata.full_name,
                content: content
            }]);

            if (!error) {
                input.value = '';
                loadComments(postId);
            }
        }

        // Load comments
        async function loadComments(postId) {
            const { data } = await supabase
                .from('comments')
                .select('*')
                .eq('post_id', postId)
                .order('created_at', { ascending: true });

            const container = document.getElementById(`comments-list-${postId}`);
            if (!data || data.length === 0) {
                container.innerHTML = '';
                return;
            }

            container.innerHTML = data.map(c => {
                const initial = c.author_name ? c.author_name.charAt(0).toUpperCase() : 'U';
                return `
                    <div class="comment-item">
                        <div class="comment-avatar">${initial}</div>
                        <div>
                            <div class="comment-bubble">
                                <div class="comment-author">${c.author_name || 'Utilisateur'}</div>
                                <div class="comment-text">${c.content}</div>
                            </div>
                            <div class="comment-time">${getTimeAgo(new Date(c.created_at))}</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Upload document
        async function uploadDocument() {
            const title = document.getElementById('docTitle').value;
            const ufr = document.getElementById('docUFR').value;
            const file = document.getElementById('docFile').files[0];

            if (!title || !ufr || !file) {
                alert('Remplissez tous les champs');
                return;
            }

            const fileName = `${Date.now()}_${file.name}`;
            const { error: uploadError } = await supabase.storage.from('documents').upload(fileName, file);

            if (uploadError) {
                alert('Erreur: ' + uploadError.message);
                return;
            }

            const { data: urlData } = supabase.storage.from('documents').getPublicUrl(fileName);
            
            const { error } = await supabase.from('documents').insert([{
                title, ufr,
                file_url: urlData.publicUrl,
                uploaded_by: currentUser.id,
                uploader_name: currentUser.user_metadata.full_name
            }]);

            if (!error) {
                document.getElementById('docTitle').value = '';
                document.getElementById('docUFR').value = '';
                document.getElementById('docFile').value = '';
                loadDocuments();
            }
        }

        // Load documents
        async function loadDocuments() {
            const { data } = await supabase.from('documents').select('*').order('created_at', { ascending: false });
            const container = document.getElementById('documentsGrid');
            
            if (!data || data.length === 0) {
                container.innerHTML = '<p style="grid-column: 1/-1; text-align: center; color: #65676b;">Aucun document</p>';
                return;
            }

            container.innerHTML = data.map(d => `
                <div class="action-card" style="text-align: center; cursor: pointer;" onclick="window.open('${d.file_url}')">
                    <div style="font-size: 3rem;">📄</div>
                    <strong style="display: block; margin: 0.5rem 0;">${d.title}</strong>
                    <div style="font-size: 0.85rem; color: #65676b;">${d.ufr}</div>
                    <div style="font-size: 0.8rem; color: #999; margin-top: 0.3rem;">${d.uploader_name || 'Anonyme'}</div>
                </div>
            `).join('');
        }

        // Create event
        async function createEvent() {
            const title = document.getElementById('eventTitle').value;
            const desc = document.getElementById('eventDesc').value;
            const date = document.getElementById('eventDate').value;
            const location = document.getElementById('eventLocation').value;

            if (!title || !date) {
                alert('Titre et date requis');
                return;
            }

            const { error } = await supabase.from('events').insert([{
                title, description: desc, event_date: date, location,
                created_by: currentUser.id
            }]);

            if (!error) {
                document.getElementById('eventTitle').value = '';
                document.getElementById('eventDesc').value = '';
                document.getElementById('eventDate').value = '';
                document.getElementById('eventLocation').value = '';
                loadEvents();
                loadUpcomingEvents();
            }
        }

        // Load events
        async function loadEvents() {
            const { data } = await supabase.from('events').select('*').order('event_date', { ascending: true });
            const container = document.getElementById('eventsGrid');
            
            if (!data || data.length === 0) {
                container.innerHTML = '<div class="action-card"><p style="text-align: center; color: #65676b;">Aucun événement</p></div>';
                return;
            }

            container.innerHTML = data.map(e => {
                const d = new Date(e.event_date);
                return `
                    <div class="action-card">
                        <h3>${e.title}</h3>
                        <p><strong>📅</strong> ${d.toLocaleDateString('fr-FR', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric', hour: '2-digit', minute: '2-digit' })}</p>
                        ${e.location ? `<p><strong>📍</strong> ${e.location}</p>` : ''}
                        ${e.description ? `<p style="margin-top: 1rem;">${e.description}</p>` : ''}
                    </div>
                `;
            }).join('');
        }

        // Load upcoming events (sidebar)
        async function loadUpcomingEvents() {
            const { data } = await supabase
                .from('events')
                .select('*')
                .gte('event_date', new Date().toISOString())
                .order('event_date', { ascending: true })
                .limit(3);

            const container = document.getElementById('upcomingEventsList');
            
            if (!data || data.length === 0) {
                container.innerHTML = '<p style="color: #65676b; font-size: 0.9rem;">Aucun événement programmé</p>';
                return;
            }

            container.innerHTML = data.map(e => {
                const d = new Date(e.event_date);
                return `
                    <div class="event-item">
                        <div class="event-date">
                            <div class="event-day">${d.getDate()}</div>
                            <div class="event-month">${d.toLocaleDateString('fr-FR', { month: 'short' }).toUpperCase()}</div>
                        </div>
                        <div class="event-details">
                            <h4>${e.title}</h4>
                            <p>🕒 ${d.toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' })}</p>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Load suggested users
        async function loadSuggestedUsers() {
            const { data } = await supabase
                .from('profiles')
                .select('*')
                .neq('id', currentUser.id)
                .limit(5);

            const container = document.getElementById('suggestedUsers');
            
            if (!data || data.length === 0) {
                container.innerHTML = '<p style="color: #65676b; font-size: 0.9rem;">Aucune suggestion</p>';
                return;
            }

            container.innerHTML = data.map(u => {
                const initial = u.full_name ? u.full_name.charAt(0).toUpperCase() : 'U';
                return `
                    <div class="user-suggestion">
                        <div class="post-avatar-small">${initial}</div>
                        <div class="suggestion-info">
                            <div class="suggestion-name">${u.full_name || 'Utilisateur'}</div>
                            <div class="suggestion-meta">${u.ufr || ''} • ${u.year || ''}</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Load profile
        function loadProfile() {
            const user = currentUser;
            const initial = user.user_metadata.full_name ? user.user_metadata.full_name.charAt(0).toUpperCase() : 'U';
            
            document.getElementById('profileAvatar').textContent = initial;
            document.getElementById('profileName').textContent = user.user_metadata.full_name || 'Utilisateur';
            document.getElementById('profileStatus').textContent = user.user_metadata.status === 'nouveau' ? 'Nouveau bachelier' : 'Ancien étudiant';
            
            document.getElementById('profileInfo').innerHTML = `
                <div class="form-group">
                    <label>Email</label>
                    <p style="padding: 0.75rem; background: var(--bg-light); border-radius: 8px;"><strong>${user.email}</strong></p>
                </div>
                <div class="form-group">
                    <label>Téléphone</label>
                    <p style="padding: 0.75rem; background: var(--bg-light); border-radius: 8px;"><strong>${user.user_metadata.phone || 'Non renseigné'}</strong></p>
                </div>
                <div class="form-group">
                    <label>UFR</label>
                    <p style="padding: 0.75rem; background: var(--bg-light); border-radius: 8px;"><strong>${user.user_metadata.ufr || 'Non renseigné'}</strong></p>
                </div>
                <div class="form-group">
                    <label>Année d'études</label>
                    <p style="padding: 0.75rem; background: var(--bg-light); border-radius: 8px;"><strong>${user.user_metadata.year || 'Non renseigné'}</strong></p>
                </div>
            `;
        }

        // Load mentorship
        async function loadMentorship() {
            const container = document.getElementById('mentorshipInfo');
            const userStatus = currentUser.user_metadata.status;

            if (userStatus === 'nouveau') {
                const { data } = await supabase
                    .from('mentorship')
                    .select(`
                        *,
                        mentor:profiles!mentorship_mentor_id_fkey(full_name, phone, ufr)
                    `)
                    .eq('mentee_id', currentUser.id)
                    .eq('status', 'active')
                    .single();

                if (data && data.mentor) {
                    container.innerHTML = `
                        <div class="action-card">
                            <h4>👨‍🏫 Votre Mentor</h4>
                            <p style="margin-top: 1rem;"><strong>Nom :</strong> ${data.mentor.full_name || 'N/A'}</p>
                            <p><strong>UFR :</strong> ${data.mentor.ufr || 'N/A'}</p>
                            <p><strong>Téléphone :</strong> ${data.mentor.phone || 'N/A'}</p>
                            <p style="margin-top: 1rem; color: #65676b;">Votre mentor vous accompagne dans vos cours, TD, TP et examens.</p>
                        </div>
                    `;
                } else {
                    container.innerHTML = `
                        <div class="action-card">
                            <p style="color: #65676b;">Vous n'avez pas encore de mentor. Contactez l'administration AEESS pour être jumelé.</p>
                        </div>
                    `;
                }
            } else {
                const { data } = await supabase
                    .from('mentorship')
                    .select(`
                        *,
                        mentee:profiles!mentorship_mentee_id_fkey(full_name, phone, ufr, year)
                    `)
                    .eq('mentor_id', currentUser.id)
                    .eq('status', 'active');

                if (data && data.length > 0) {
                    container.innerHTML = `
                        <h4 style="margin-bottom: 1rem;">👥 Vos Filleuls</h4>
                        ${data.map(m => `
                            <div class="action-card" style="margin-bottom: 1rem;">
                                <p><strong>Nom :</strong> ${m.mentee.full_name || 'N/A'}</p>
                                <p><strong>UFR :</strong> ${m.mentee.ufr || 'N/A'}</p>
                                <p><strong>Année :</strong> ${m.mentee.year || 'N/A'}</p>
                                <p><strong>Téléphone :</strong> ${m.mentee.phone || 'N/A'}</p>
                            </div>
                        `).join('')}
                    `;
                } else {
                    container.innerHTML = `
                        <div class="action-card">
                            <p style="color: #65676b;">Vous n'êtes pas encore mentor. Proposez-vous pour accompagner un nouveau!</p>
                        </div>
                    `;
                }
            }
        }

        // Search content
        function searchContent() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            if (!query) {
                loadSocialPosts();
                return;
            }

            const posts = document.querySelectorAll('.post-card');
            posts.forEach(post => {
                const content = post.textContent.toLowerCase();
                post.style.display = content.includes(query) ? 'block' : 'none';
            });
        }

        // Utility functions
        function getTimeAgo(date) {
            const seconds = Math.floor((new Date() - date) / 1000);
            
            let interval = seconds / 31536000;
            if (interval > 1) return Math.floor(interval) + " an" + (Math.floor(interval) > 1 ? "s" : "");
            
            interval = seconds / 2592000;
            if (interval > 1) return Math.floor(interval) + " mois";
            
            interval = seconds / 86400;
            if (interval > 1) return Math.floor(interval) + " j";
            
            interval = seconds / 3600;
            if (interval > 1) return Math.floor(interval) + " h";
            
            interval = seconds / 60;
            if (interval > 1) return Math.floor(interval) + " min";
            
            return "À l'instant";
        }

        // Close modal on outside click
        window.onclick = function(e) {
            if (e.target.classList.contains('modal')) {
                e.target.classList.remove('active');
            }
        }

        // Initialize
        checkAuth();
    </script>
</body>
</html>
